<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>RIMO ‚Äî Ïñ¥ÎìúÎØº ¬∑ ÌÅ¨Î£® ÏÉùÏÑ±</title>
<style>
  :root{
    --bg:#0b0b0f; --fg:#e8e8ef; --muted:#b9b9cc; --line:#232333;
    --tile:#141627; --tile2:#101223; --accent:#7aa7ff; --good:#2aa84a; --bad:#ff5d5d;
    --chip-bg:#14172a; --chip-bd:#2b2e54; --accent-glow: rgba(122,167,255,.35);

    /* Theme Colors */
    --t-red:#ff5d5d;      --t-red-bg:rgba(255,93,93,.14);      --t-red-br:rgba(255,93,93,.35);
    --t-blue:#7aa7ff;     --t-blue-bg:rgba(122,167,255,.14);   --t-blue-br:rgba(122,167,255,.35);
    --t-yellow:#ffd85d;   --t-yellow-bg:rgba(255,216,93,.16);  --t-yellow-br:rgba(255,216,93,.38);
    --t-green:#56d364;    --t-green-bg:rgba(86,211,100,.16);   --t-green-br:rgba(86,211,100,.42);
    --t-purple:#a78bfa;   --t-purple-bg:rgba(167,139,250,.16); --t-purple-br:rgba(167,139,250,.42);

    /* ÎùºÎ≤®/Í∞ÑÍ≤© */
    --label-w: 56px; --label-gap: 2px;
    --label-w-sm: 44px; --label-gap-sm: 2px;
  }
  *{box-sizing:border-box}
  body{margin:0;background:var(--bg);color:var(--fg);font-family:-apple-system,BlinkMacSystemFont,"Noto Sans KR",Roboto,Arial,sans-serif}

  header{position:sticky;top:0;z-index:5;background:rgba(11,11,15,.9);backdrop-filter:blur(8px);border-bottom:1px solid var(--line)}
  .bar{display:flex;gap:10px;align-items:center;justify-content:space-between;padding:12px 16px}
  .title{font-weight:900;font-size:16px}
  .home-btn{width:36px;height:36px;display:flex;align-items:center;justify-content:center;font-size:30px;border-radius:8px;border:none;background:transparent;cursor:pointer;transition:background .2s}
  .home-btn:hover{background:rgba(255,255,255,.08)}

  main{padding:16px;display:grid;gap:16px;max-width:980px;margin:0 auto;padding-bottom:120px}
  .panel{background:var(--tile);border:1px solid var(--line);border-radius:14px;padding:4px 14px 16px 16px}

  /* Ìèº Í∑∏Î¶¨Îìú */
  .row{display:grid;grid-template-columns: var(--label-w) 1fr;gap: var(--label-gap);align-items:center;margin:10px 0}
  .row.no-label{grid-template-columns:1fr}
  .row>label{font-weight:700;color:#cfd1e8;font-size:14px;justify-self:start;text-align:left;white-space:nowrap}
  .field{min-width:0}.field>*{width:100%}
  @media (max-width:560px){ .row{grid-template-columns: var(--label-w-sm) 1fr;gap: var(--label-gap-sm)} }

  input,select,textarea{width:100%;padding:10px 12px;border-radius:10px;border:1px solid #2c2f48;background:#0f1020;color:#fff;font-size:14px;transition:border-color .15s, box-shadow .15s}
  input:focus,select:focus,textarea:focus{outline:none;border-color:var(--accent);box-shadow:0 0 0 2px var(--accent-glow),0 0 0 1px var(--accent) inset}
  .row:has(input:focus),.row:has(select:focus),.row:has(textarea:focus)>label{color:#eef3ff}

  .coords{display:grid;grid-template-columns:1fr 1fr;gap:10px}

  .toggles{display:flex;gap:10px;flex-wrap:wrap;margin:0}
  .toggle{display:inline-flex;align-items:center;gap:14px;padding:8px 12px;border-radius:999px;color:#e6e9ff;font-size:13px;cursor:pointer;user-select:none;white-space:nowrap;transition:transform .15s, box-shadow .15s;background:var(--chip-bg); border:1px solid var(--chip-bd)}
  .toggle.active{border-color:var(--accent); background:rgba(122,167,255,.16); box-shadow:0 0 10px var(--accent-glow); transform:translateY(-1px) scale(1.01); font-weight:500}

  .themes{display:flex;gap:8px;flex-wrap:wrap;margin-top:10px}
  .theme-btn{display:grid;grid-template-columns:auto 1fr;align-items:center;gap:0;padding:4px 8px;border-radius:16px;border:1px solid #2b2e48;background:#14172a;color:#e8e8ef;font-size:12px;font-weight:500;cursor:pointer;user-select:none;flex:0 0 auto;white-space:nowrap;transition:transform .12s, box-shadow .12s}
  .theme-btn .badge{width:14px;height:14px;border-radius:6px;display:flex;align-items:center;justify-content:center;font-size:12px;background:#0f1020;border:0}
  .theme-btn.active{transform:translateY(-1px) scale(1.02);box-shadow:0 0 0 1px currentColor inset, 0 0 12px currentColor;background:transparent}
  .theme-btn[data-theme="red"]{color:var(--t-red);background:var(--t-red-bg);border-color:var(--t-red-br)}
  .theme-btn[data-theme="blue"]{color:var(--t-blue);background:var(--t-blue-bg);border-color:var(--t-blue-br)}
  .theme-btn[data-theme="yellow"]{color:var(--t-yellow);background:var(--t-yellow-bg);border-color:var(--t-yellow-br)}
  .theme-btn[data-theme="green"]{color:var(--t-green);background:var(--t-green-bg);border-color:var(--t-green-br)}
  .theme-btn[data-theme="purple"]{color:var(--t-purple);background:var(--t-purple-bg);border-color:var(--t-purple-br)}

  .btn{padding:10px 14px;border-radius:10px;border:1px solid #2b2e48;background:#1b1d2e;color:#fff;cursor:pointer;margin-top:6px;font-weight:700}
  .btn.primary{background:#2a5bff;border-color:#3d6aff}
  .btnbar{display:flex;gap:8px;flex-wrap:wrap;margin-top:10px;justify-content:center;}

  /* ===== Í≥µÌÜµ Ïπ¥Îìú Ïª¥Ìè¨ÎÑåÌä∏ ===== */
  .r-card{
    position:relative; background:#121428; border:1px solid rgba(255,255,255,.14);
    border-radius:16px; padding:14px; box-shadow:0 2px 14px rgba(0,0,0,.28);margin-bottom:10px
  }
  .r-card h3{margin:0 0 6px;font-size:16px;font-weight:700}
  .r-meta{display:flex;align-items:center;gap:4px;color:#cfd2ff;font-size:14px}
  .r-route{display:flex;align-items:center;gap:8px;margin:6px 0 4px;color:#ced2f9;font-size:14px}
  .r-msg{color:#e6e8ff;font-size:14px;margin:6px 0}
  .r-chips{display:flex;flex-wrap:wrap;gap:8px;margin-top:6px}
  .r-chip{
    padding:6px 10px;border-radius:999px;font-size:12px;font-weight:700;
    background:rgba(255,255,255,.06);border:1px solid rgba(255,255,255,.16);color:#e6e8ef
  }
  .r-chip.is-urban{background:#1e2d55;border-color:#2c4484}
  .r-chip.is-curve{background:#2a1f56;border-color:#40307a}
  .r-chip.is-tour{background:#1e3b3a;border-color:#2f5f5d}
  .r-chip.is-easy{background:#1f3a1f;border-color:#2f5a2f}
  .r-chip.is-balanced{background:#3a341e;border-color:#5a4f2f}
  .r-chip.is-dynamic{background:#3a1f1f;border-color:#5a2f2f}

  .r-btm{
    margin-top:10px;padding:10px 12px;border-radius:12px;
    background:rgba(255,255,255,.06); border:1px solid rgba(255,255,255,.14);
    color:#dfe3ff;font-weight:800;display:flex;align-items:center;gap:10px;justify-content:flex-start
  }

  .r-del{
    position:absolute; top:8px; right:8px;
    width:28px; height:28px; border-radius:8px; border:1px solid #2b2e48;
    background:#171a2c; color:#cfd2ff; font-weight:900; cursor:pointer;
  }
  .r-del:hover{background:#1f2340}

  .r-card[data-theme="red"]   { border-color:var(--t-red-br) }
  .r-card[data-theme="blue"]  { border-color:var(--t-blue-br) }
  .r-card[data-theme="yellow"]{ border-color:var(--t-yellow-br) }
  .r-card[data-theme="green"] { border-color:var(--t-green-br) }
  .r-card[data-theme="purple"]{ border-color:var(--t-purple-br) }

  .edit-banner{margin:8px 0 0;color:#cfe0ff;font-size:12px}

  .btmnav{position:fixed;left:0;right:0;bottom:0;z-index:10;background:rgba(11,11,15,.9);backdrop-filter:blur(10px);border-top:1px solid var(--line)}
  .btmnav .wrap{max-width:980px;margin:0 auto;display:grid;grid-template-columns:repeat(5,minmax(0,1fr));gap:10px;padding:8px}
  .navitem{display:flex;flex-direction:column;align-items:center;justify-content:center;gap:4px;padding:8px 4px;border-radius:10px;border:1px solid #2b2e48;background:#14172a;cursor:pointer;font-size:12px;text-align:center;user-select:none;text-decoration:none;color:var(--fg)}
  .navitem.active{background:#27306a;border-color:#3a4aa2}
  .navitem .ico{font-size:18px;line-height:1}

  .small-btn{margin-left:auto;padding:6px 10px;border-radius:8px;border:1px solid #2b2e48;background:#14172a;color:#e6e8ef;cursor:pointer;font-size:12px}
  .list-head{display:flex;align-items:center;gap:10px;margin:0 0 8px 0}

  #cardsPanel { padding: 12px 16px 6px; margin-top: 16px; margin-bottom: 0; }
  .hint{color:#cfd2ff99;font-size:14px;padding:12px}
</style>
</head>
<body>
<header>
  <div class="bar">
    <div class="title">üèçÔ∏è RIMO ‚Äî Ïñ¥ÎìúÎØº ¬∑ ÌÅ¨Î£® ÏÉùÏÑ±</div>
    <button class="home-btn" id="goMain" title="Î©îÏù∏ Ïù¥Îèô">üè†</button>
  </div>
</header>

<main>
  <!-- ‚Ä¶ (ÏúÑÏ™Ω form Ìå®ÎÑê Î∂ÄÎ∂Ñ ÎèôÏùº) ‚Ä¶ -->

  <section class="panel" id="cardsPanel">
    <div class="list-head">
      <h3 style="margin:0;font-size:16px;">Î∞úÌñâÎêú ÎùºÏù¥Îî© Ïπ¥Îìú Î™©Î°ù</h3>
      <button class="small-btn" id="btnClearHidden">üíæ Î≥µÍµ¨</button>
      <button class="small-btn" id="btnResync">ÎèôÍ∏∞Ìôî üîÑ</button>
    </div>
    <div id="cards" class="cards"></div>
  </section>
</main>

<nav class="btmnav">
  <div class="wrap">
    <!-- nav items ÎèôÏùº -->
  </div>
</nav>

<script>
/* ---------- ÌïµÏã¨ ÏàòÏ†ïÎêú Î∂ÄÎ∂ÑÎßå ÌïòÏù¥ÎùºÏù¥Ìä∏ ---------- */

/* ÏïàÏ†ÑÌïú ÏÑúÎ≤Ñ Ìò∏Ï∂ú */
async function loadFromServer(){
  let cached=[]; 
  try { cached=JSON.parse(localStorage.getItem(PUBLIST_KEY)||'[]'); }catch(_){}
  if(cached.length) renderCards(cached);

  const listURL = WEB_APP_URL + `?op=list&scope=all${SHARED_TOKEN ? `&token=${encodeURIComponent(SHARED_TOKEN)}`:''}&_=${Date.now()}`;

  let serverRows=null;
  try{
    const res=await fetch(listURL,{cache:'no-store'});
    if(res.ok){
      const data=await res.json().catch(()=>null);
      if(Array.isArray(data)) serverRows=data;
      else if(Array.isArray(data?.rows)) serverRows=data.rows;
    }
  }catch(e){ console.warn(e); }

  if(!serverRows){
    try{
      const data=await fetchJSONP(listURL);
      if(Array.isArray(data)) serverRows=data;
      else if(Array.isArray(data?.rows)) serverRows=data.rows;
    }catch(e){ console.warn(e); }
  }

  if(!Array.isArray(serverRows)||!serverRows.length){
    return cached;
  }
  const merged=mergeById(cached,serverRows);
  save(PUBLIST_KEY,merged);
  renderCards(merged);
  return merged;
}

/* ÎèôÍ∏∞Ìôî Î≤ÑÌäº */
async function fullResync(){
  const backup=load(PUBLIST_KEY,[]);
  try{
    const rows=await loadFromServer();
    if(Array.isArray(rows)&&rows.length){
      save(PUBLIST_KEY,rows);
      renderCards(rows);
      return;
    }
    renderCards(backup);
    alert('ÏÑúÎ≤Ñ Î™©Î°ù ÏóÜÏùå ‚Üí Í∏∞Ï°¥ Ïú†ÏßÄ');
  }catch(e){
    console.warn(e);
    renderCards(backup);
    alert('ÎèôÍ∏∞Ìôî Ïã§Ìå® ‚Üí Í∏∞Ï°¥ Î™©Î°ù Ïú†ÏßÄ');
  }
}
</script>
</body>
</html>
