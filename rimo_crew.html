<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>RIMO â€” ì–´ë“œë¯¼ Â· í¬ë£¨ ìƒì„±</title>
<style>
  :root{
    --bg:#0b0b0f; --fg:#e8e8ef; --muted:#b9b9cc; --line:#232333;
    --tile:#141627; --tile2:#101223; --accent:#7aa7ff; --good:#2aa84a; --bad:#ff5d5d;
    --chip-bg:#14172a; --chip-bd:#2b2e54; --chip-on:#27306a; --chip-on-bd:#3a4aa2;
  }
  *{box-sizing:border-box}
  body{margin:0;background:var(--bg);color:var(--fg);font-family:-apple-system,BlinkMacSystemFont,"Noto Sans KR",Roboto,Arial,sans-serif}

  /* í—¤ë” */
  header{position:sticky;top:0;z-index:5;background:rgba(11,11,15,.9);backdrop-filter:blur(8px);border-bottom:1px solid var(--line)}
  .bar{display:flex;gap:10px;align-items:center;justify-content:space-between;padding:12px 16px}
  .title{font-weight:900;font-size:16px}
  .home-btn{width:36px;height:36px;display:flex;align-items:center;justify-content:center;font-size:30px;border-radius:8px;border:none;background:transparent;cursor:pointer;transition:background .2s}
  .home-btn:hover{background:rgba(255,255,255,.08)}

  /* ë³¸ë¬¸ ë ˆì´ì•„ì›ƒ */
  main{padding:16px;display:grid;gap:16px;max-width:980px;margin:0 auto;padding-bottom:120px}
  .panel{background:var(--tile);border:1px solid var(--line);border-radius:14px;padding:14px}
  .panel h3{margin:0 0 12px;font-size:16px}

  /* í–‰/ë¼ë²¨/í•„ë“œ */
  .row{display:grid;grid-template-columns:40px 1fr;gap:0px;align-items:center;margin:10px 0}
  @media (max-width:560px){ .row{grid-template-columns:80px 1fr} }
  .row > label{width: var(--label-width);font-weight:700;color:#cfd1e8;font-size:14px}
  .field{display:block}
  input,select,textarea{
    width:100%;padding:10px 12px;border-radius:10px;border:1px solid #2c2f48;background:#0f1020;color:#fff;font-size:14px
  }
  textarea{min-height:90px;resize:vertical}
  .hint{color:var(--muted);font-size:12px;margin-top:6px}

  .two{display:grid;grid-template-columns:1fr 1fr;gap:10px}
  .pair-46{display:grid;grid-template-columns:4fr 6fr;gap:10px} /* ì¸ì›(ë‘ ì¹¸) : í…Œë§ˆ  = 4:6 */
  @media (max-width:720px){ .two, .pair-46{grid-template-columns:1fr} }

  /* ì¹© ë²„íŠ¼ */
  .chips{display:flex;gap:8px;flex-wrap:wrap}
  .chip{display:inline-flex;align-items:center;gap:6px;padding:8px 12px;border-radius:999px;background:var(--chip-bg);border:1px solid var(--chip-bd);cursor:pointer;font-size:13px}
  .chip.on{background:var(--chip-on);border-color:var(--chip-on-bd)}
  .chip .x{display:none}
  .chip.on .x{display:inline}

  /* ìˆ«ì/ì¢Œí‘œ ë³´ì¡° ë²„íŠ¼ */
  .inline{display:grid;grid-template-columns:1fr auto;gap:8px;align-items:center}
  .btn{padding:10px 14px;border-radius:10px;border:1px solid #2b2e48;background:#1b1d2e;color:#fff;cursor:pointer}
  .btn.small{padding:8px 10px;font-size:12px}
  .btn.primary{background:#2a5bff;border-color:#3d6aff}
  .btnbar{display:flex;gap:8px;flex-wrap:wrap;margin-top:10px}

  /* ì¹´ë“œ ëª©ë¡ */
  .cards{display:grid;gap:10px;margin-top:10px}
  .card{background:#141628;border:1px solid var(--line);border-radius:12px;padding:12px}
  .card .tt{font-weight:800}
  .card .sub{color:#c8cae0;font-size:12px;margin-top:4px}

  /* í•˜ë‹¨ ë„¤ë¹„ */
  .btmnav{position:fixed;left:0;right:0;bottom:0;z-index:10;background:rgba(11,11,15,.9);backdrop-filter:blur(10px);border-top:1px solid var(--line)}
  .btmnav .wrap{max-width:980px;margin:0 auto;display:grid;grid-template-columns:repeat(5,minmax(0,1fr));gap:10px;padding:8px}
  .navitem{display:flex;flex-direction:column;align-items:center;justify-content:center;gap:4px;padding:8px 4px;border-radius:10px;border:1px solid #2b2e48;background:#14172a;cursor:pointer;font-size:12px;text-align:center;user-select:none;transition:background .2s,transform .1s;text-decoration:none;color:var(--fg)}
  .navitem.active{background:#27306a;border-color:#3a4aa2}
  .navitem .ico{font-size:18px;line-height:1}
  .navitem:active{transform:translateY(1px)}
</style>
</head>
<body>
<header>
  <div class="bar">
    <div class="title">ğŸï¸ RIMO â€” ì–´ë“œë¯¼ Â· í¬ë£¨ ìƒì„±</div>
    <button class="home-btn" id="goMain" title="ë©”ì¸ ì´ë™">ğŸ </button>
  </div>
</header>

<main>
  <section class="panel">
    <h3>í¬ë£¨ ìƒì„±</h3>

    <!-- ì œëª© -->
    <div class="row">
      <label for="c_title">ì œëª©</label>
      <div class="field">
        <input id="c_title" placeholder="ì˜ˆ: &lt;ê°€ì„ë§ì´ ì¹´í˜ ë¼ì´ë”©&gt;">
      </div>
    </div>

    <!-- ì¼ì‹œ: ë„¤ì´í‹°ë¸Œ ë‚ ì§œÂ·ì‹œê°„ ì„ íƒê¸° -->
    <div class="row">
      <label for="c_datetime">ì¼ì‹œ</label>
      <div class="field">
        <input id="c_datetime" type="datetime-local" step="1800">
        <div class="hint">(ë„¤ì´í‹°ë¸Œ ë‚ ì§œÂ·ì‹œê°„ ì„ íƒê¸° â€” 30ë¶„ ê°„ê²©)</div>
      </div>
    </div>

    <!-- ì¶œë°œ/ë„ì°© ì§€ëª… -->
    <div class="row">
      <label for="c_from">ì¶œë°œ</label>
      <div class="field"><input id="c_from" placeholder="ì˜ˆ: GS25 í•œê°•ë¥´ë„¤ìƒìŠ¤ ë°˜í¬2í˜¸"></div>
    </div>

    <div class="row">
      <label for="c_to">ë„ì°©</label>
      <div class="field"><input id="c_to" placeholder="ì˜ˆ: RSG ì„±ìˆ˜"></div>
    </div>

    <!-- ë°°ê¸°ëŸ‰ ë“œë¡­ë‹¤ìš´ -->
    <div class="row">
      <label for="c_cc">ë°°ê¸°ëŸ‰</label>
      <div class="field">
        <select id="c_cc">
          <option value="">ì „ì²´</option>
          <option>125cc ì´í•˜</option>
          <option>125~250</option>
          <option>250~400</option>
          <option>400~800</option>
          <option>800 ì´ìƒ</option>
        </select>
      </div>
    </div>

    <!-- ìŠ¤íƒ€ì¼/í˜ì´ìŠ¤ ì¹© -->
    <div class="row">
      <label>ìŠ¤íƒ€ì¼</label>
      <div class="field"><div id="styleChips" class="chips"></div></div>
    </div>
    <div class="row">
      <label>í˜ì´ìŠ¤</label>
      <div class="field"><div id="paceChips" class="chips"></div></div>
    </div>

    <!-- ë©”ì‹œì§€ (30ì ì´ë‚´) -->
    <div class="row">
      <label for="c_msg">ë©”ì‹œì§€</label>
      <div class="field">
        <textarea id="c_msg" maxlength="30" placeholder="30ì ì´ë‚´"></textarea>
        <div class="hint">[ 30ì ì´ë‚´ ] <span id="msgCount">0</span>/30</div>
      </div>
    </div>

    <hr style="border:none;border-top:1px solid var(--line);margin:16px 0">

    <!-- ì¢Œí‘œ -->
    <div class="row">
      <label>ì¶œë°œ ì§€ì •<br><span style="font-size:12px;color:#9ea1c9">ìœ„ë„, ê²½ë„</span></label>
      <div class="field two">
        <input id="from_lat" type="number" step="any" placeholder="ìœ„ë„ (ì˜ˆ: 37.5665)" inputmode="decimal" min="-90" max="90">
        <div class="inline">
          <input id="from_lng" type="number" step="any" placeholder="ê²½ë„ (ì˜ˆ: 126.9780)" inputmode="decimal" min="-180" max="180">
          <button class="btn small" id="btnPasteFrom">ğŸ“‹ ë¶™ì—¬ë„£ê¸°</button>
        </div>
      </div>
    </div>

    <div class="row">
      <label>ë„ì°© ì§€ì •<br><span style="font-size:12px;color:#9ea1c9">ìœ„ë„, ê²½ë„</span></label>
      <div class="field two">
        <input id="to_lat" type="number" step="any" placeholder="ìœ„ë„" inputmode="decimal" min="-90" max="90">
        <div class="inline">
          <input id="to_lng" type="number" step="any" placeholder="ê²½ë„" inputmode="decimal" min="-180" max="180">
          <button class="btn small" id="btnPasteTo">ğŸ“‹ ë¶™ì—¬ë„£ê¸°</button>
        </div>
      </div>
    </div>

    <!-- ì¸ì›( ) / ( )  +  í…Œë§ˆ ë“œë¡­ë‹¤ìš´ (4:6) -->
    <div class="row">
      <label>ì¸ì› / í…Œë§ˆ</label>
      <div class="field pair-46">
        <div class="two">
          <input id="c_capacity_min" type="number" min="1" placeholder="ì¸ì›(1)">
          <input id="c_capacity" type="number" min="1" placeholder="ì¸ì›(2)">
        </div>
        <select id="c_theme" title="í…Œë§ˆ">
          <option value="blue" selected>blue</option>
          <option value="red">red</option>
          <option value="yellow">yellow</option>
          <option value="green">green</option>
        </select>
      </div>
    </div>

    <!-- ê¸°ëŠ¥ ë²„íŠ¼ë“¤ -->
    <div class="btnbar">
      <button class="btn" id="btnDraft"># ë“œë˜í”„íŠ¸ ì €ì¥</button>
      <button class="btn primary" id="btnPublish"># ë©”ì¸ì— ë°œí–‰</button>
      <button class="btn" id="btnReset"># ìƒˆë¡œ ì‘ì„±</button>
    </div>
  </section>

  <!-- ë°œí–‰ëœ ë¼ì´ë”© ì¹´ë“œ ëª©ë¡ -->
  <section class="panel">
    <h3>ë°œí–‰ëœ ë¼ì´ë”© ì¹´ë“œ ëª©ë¡</h3>
    <div id="cards" class="cards"></div>
  </section>
</main>

<nav class="btmnav" aria-label="í•˜ë‹¨ ë‚´ë¹„ê²Œì´ì…˜">
  <div class="wrap">
    <a class="navitem active" href="rimo_crew.html" title="í¬ë£¨ ìƒì„±">
      <div class="ico">ğŸ› ï¸</div><div>í¬ë£¨ ìƒì„±</div>
    </a>
    <a class="navitem" href="rimo_joins.html" title="ë§¤ì¹­ í¬ë§">
      <div class="ico">ğŸ¤</div><div>ë§¤ì¹­ í¬ë§</div>
    </a>
    <a class="navitem" href="rimo_routes.html" title="ë£¨íŠ¸ ì œì•ˆ">
      <div class="ico">ğŸ—ºï¸</div><div>ë£¨íŠ¸ ì œì•ˆ</div>
    </a>
    <a class="navitem" href="rimo_feedback.html" title="í›„ê¸° ëª¨ìŒ">
      <div class="ico">ğŸ“</div><div>í›„ê¸° ëª¨ìŒ</div>
    </a>
    <a class="navitem" href="rimo_data.html" title="ìë£Œ ê´€ë¦¬">
      <div class="ico">ğŸ—„ï¸</div><div>ìë£Œ ê´€ë¦¬</div>
    </a>
  </div>
</nav>

<script>
/* ---------- ê¸°ë³¸ ì„¤ì • ---------- */
const MAIN_URL = "https://roowalix.github.io/RIMO-test/index.html"; // í•„ìš” ì‹œ êµì²´

/* ---------- ì¹© ì˜µì…˜ ---------- */
const STYLE_OPTS = ["Urban","Curve","Tour"];
const PACE_OPTS  = ["Easy","Balanced","Dynamic"];

/* ---------- ìœ í‹¸ ---------- */
const qs=(s,p=document)=>p.querySelector(s);
const qsa=(s,p=document)=>Array.from(p.querySelectorAll(s));
const save=(k,v)=>localStorage.setItem(k,JSON.stringify(v));
const load=(k,def)=>{try{return JSON.parse(localStorage.getItem(k)||JSON.stringify(def))}catch(e){return def}};
function makeChip(label,on=false){
  const el=document.createElement('button');
  el.type='button';
  el.className='chip'+(on?' on':'');
  el.dataset.val=label;
  el.innerHTML=`<span>${label}</span><span class="x">âœ“</span>`;
  el.addEventListener('click',()=>el.classList.toggle('on'));
  return el;
}
function renderChips(id,opts,sel=[]){
  const box=qs('#'+id); box.innerHTML='';
  opts.forEach(o=>box.appendChild(makeChip(o,sel.includes(o))));
}
function selectedChips(id){ return qsa('#'+id+' .chip.on').map(c=>c.dataset.val); }
function pad(n){return String(n).padStart(2,'0')}
function formatKDate(dt){return `${dt.getMonth()+1}ì›” ${dt.getDate()}ì¼ ${pad(dt.getHours())}:${pad(dt.getMinutes())}`}

/* datetime-local value â†” Date */
function toLocalDatetimeValue(d){
  const y=d.getFullYear(), m=pad(d.getMonth()+1), day=pad(d.getDate()), hh=pad(d.getHours()), mi=pad(d.getMinutes());
  return `${y}-${m}-${day}T${hh}:${mi}`;
}
function getDateFromInput(){
  const v = qs('#c_datetime').value;
  if(!v) return null;
  const [date,time] = v.split('T');
  if(!date||!time) return null;
  const [Y,M,D] = date.split('-').map(Number);
  const [h,m] = time.split(':').map(Number);
  return new Date(Y, M-1, D, h, m||0, 0);
}

/* ---------- ì¢Œí‘œ ë¶™ì—¬ë„£ê¸° ---------- */
async function pasteCoords(targetLatId,targetLngId){
  try{
    const text = await navigator.clipboard.readText();
    const nums = text.split(/[,\s]+/).map(v=>parseFloat(v)).filter(v=>!Number.isNaN(v));
    if(nums.length>=2){
      const [a,b]=nums;
      let lat=a, lng=b;
      qs('#'+targetLatId).value = lat;
      qs('#'+targetLngId).value = lng;
    }else{
      alert('í´ë¦½ë³´ë“œì—ì„œ ì¢Œí‘œë¥¼ ì°¾ì§€ ëª»í–ˆìŠµë‹ˆë‹¤. "ìœ„ë„,ê²½ë„" í˜•íƒœë¡œ ë³µì‚¬í•´ ì£¼ì„¸ìš”.');
    }
  }catch(e){ alert('í´ë¦½ë³´ë“œ ì ‘ê·¼ì´ ì°¨ë‹¨ë˜ì—ˆìŠµë‹ˆë‹¤. ë¸Œë¼ìš°ì € ê¶Œí•œì„ í™•ì¸í•˜ì„¸ìš”.'); }
}

/* ---------- í¼ ìˆ˜ì§‘ ---------- */
function getForm(){
  const dt = getDateFromInput() || new Date();
  return {
    title: qs('#c_title').value.trim(),
    datetime: dt.toISOString(),
    datetime_display: formatKDate(dt),
    from: qs('#c_from').value.trim(),
    to: qs('#c_to').value.trim(),
    from_lat: parseFloat(qs('#from_lat').value||''),
    from_lng: parseFloat(qs('#from_lng').value||''),
    to_lat: parseFloat(qs('#to_lat').value||''),
    to_lng: parseFloat(qs('#to_lng').value||''),
    cc: qs('#c_cc').value,
    styles: selectedChips('styleChips'),
    pace: selectedChips('paceChips'),
    message: qs('#c_msg').value.trim(),
    capacity_min: parseInt(qs('#c_capacity_min').value||'0',10),
    capacity: parseInt(qs('#c_capacity').value||'0',10),
    theme: qs('#c_theme').value
  };
}

/* ---------- ìœ íš¨ì„± ---------- */
function validate(form){
  const errs=[];
  if(!form.title) errs.push('ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”.');
  if(!qs('#c_datetime').value) errs.push('ì¼ì‹œë¥¼ ì„ íƒí•˜ì„¸ìš”.');
  if(!form.from) errs.push('ì¶œë°œì„ ì…ë ¥í•˜ì„¸ìš”.');
  if(!form.to) errs.push('ë„ì°©ì„ ì…ë ¥í•˜ì„¸ìš”.');
  if(!(form.capacity>0)) errs.push('ì¸ì›(2)ì€ 1 ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤.');
  if(form.message.length>30) errs.push('ë©”ì‹œì§€ëŠ” 30ì ì´ë‚´ì…ë‹ˆë‹¤.');
  return errs;
}

/* ---------- ì €ì¥/ë°œí–‰/ì´ˆê¸°í™” ---------- */
const DRAFT_KEY='rimo_create_draft_v4';
const PUBLIST_KEY='rimo_published_cards_v1';

function loadDraft(){
  const d=load(DRAFT_KEY,null);
  // ì¹© ë¨¼ì €
  renderChips('styleChips', STYLE_OPTS, d?.styles||[]);
  renderChips('paceChips',  PACE_OPTS,  d?.pace||[]);

  // datetime ì´ˆê¸°ê°’
  const now = new Date();
  const dt = d?.datetime ? new Date(d.datetime) : now;
  qs('#c_datetime').value = toLocalDatetimeValue(dt);

  if(!d) return;
  qs('#c_title').value=d.title||'';
  qs('#c_from').value=d.from||'';
  qs('#c_to').value=d.to||'';
  qs('#from_lat').value=d.from_lat??'';
  qs('#from_lng').value=d.from_lng??'';
  qs('#to_lat').value=d.to_lat??'';
  qs('#to_lng').value=d.to_lng??'';
  qs('#c_cc').value=d.cc||'';
  qs('#c_msg').value=d.message||'';
  qs('#c_capacity_min').value=d.capacity_min||'';
  qs('#c_capacity').value=d.capacity||'';
  qs('#c_theme').value=d.theme||'blue';
  updateMsgCount();
}
function saveDraft(){
  const form=getForm();
  save(DRAFT_KEY, form);
  alert('ë“œë˜í”„íŠ¸ ì €ì¥ ì™„ë£Œ');
}
function publish(){
  const form=getForm();
  const errs=validate(form);
  if(errs.length){ alert(errs.join('\n')); return; }
  form.id = `crew_${Date.now().toString(36)}`;
  const list = load(PUBLIST_KEY,[]);
  list.unshift(form);
  save(PUBLIST_KEY,list);
  save(DRAFT_KEY, form);
  renderCards();
  alert('ë©”ì¸ì— ì„ì‹œ ë°œí–‰(ë¡œì»¬)ë˜ì—ˆìŠµë‹ˆë‹¤.');
}
function resetForm(){
  localStorage.removeItem(DRAFT_KEY);
  location.reload();
}

/* ---------- ì¹´ë“œ ë Œë” ---------- */
function renderCards(){
  const box=qs('#cards'); box.innerHTML='';
  const list = load(PUBLIST_KEY,[]);
  if(list.length===0){ box.innerHTML='<div class="hint">ì•„ì§ ë°œí–‰ëœ ì¹´ë“œê°€ ì—†ìŠµë‹ˆë‹¤.</div>'; return; }
  list.forEach(it=>{
    const el=document.createElement('div');
    el.className='card';
    el.innerHTML = `
      <div class="tt">${it.title||'(ì œëª© ì—†ìŒ)'} <span class="sub">Â· ${it.datetime_display||''}</span></div>
      <div class="sub">${it.from||'-'} â†’ ${it.to||'-'}</div>
      <div class="sub">ì¢Œí‘œ: (${it.from_lat??'-'}, ${it.from_lng??'-'}) â†’ (${it.to_lat??'-'}, ${it.to_lng??'-'})</div>
      <div class="sub">ë°°ê¸°ëŸ‰: ${it.cc||'ì „ì²´'} Â· ì¸ì›: ${it.capacity_min||'-'} / ${it.capacity||'-'} Â· í…Œë§ˆ: ${it.theme||'-'}</div>
      <div class="sub">ìŠ¤íƒ€ì¼: ${(it.styles||[]).join(', ')||'-'} Â· í˜ì´ìŠ¤: ${(it.pace||[]).join(', ')||'-'}</div>
      <div class="sub">ë©”ì‹œì§€: ${it.message||'-'}</div>
    `;
    box.appendChild(el);
  });
}

/* ---------- ì´ë²¤íŠ¸/ì´ˆê¸°í™” ---------- */
function updateMsgCount(){
  qs('#msgCount').textContent = (qs('#c_msg').value||'').length;
}

(function init(){
  // ì¹©
  renderChips('styleChips', STYLE_OPTS, []);
  renderChips('paceChips',  PACE_OPTS,  []);

  // datetime ê¸°ë³¸ê°’
  qs('#c_datetime').value = toLocalDatetimeValue(new Date());

  // ë©”ì‹œì§€ ì¹´ìš´íŠ¸
  qs('#c_msg').addEventListener('input', updateMsgCount);

  // ë²„íŠ¼
  qs('#btnDraft').addEventListener('click', saveDraft);
  qs('#btnPublish').addEventListener('click', publish);
  qs('#btnReset').addEventListener('click', resetForm);
  qs('#btnPasteFrom').addEventListener('click', ()=>pasteCoords('from_lat','from_lng'));
  qs('#btnPasteTo').addEventListener('click', ()=>pasteCoords('to_lat','to_lng'));

  // ë“œë˜í”„íŠ¸ ë³µì› & ì¹´ë“œ ëª©ë¡
  loadDraft();
  renderCards();

  // í—¤ë” í™ˆ ì´ë™
  qs('#goMain')?.addEventListener('click',(e)=>{
    if(!MAIN_URL || MAIN_URL==="#"){ e.preventDefault(); alert("MAIN_URLì„ ë©”ì¸ì£¼ì†Œë¡œ ì„¤ì •í•˜ì„¸ìš”."); return; }
    window.open(MAIN_URL,'_blank');
  });
})();
</script>
</body>
</html>
