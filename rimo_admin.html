<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>RIMO â€” ê´€ë¦¬ì ë¯¸ë‹ˆí˜ì´ì§€</title>
<style>
  :root{
    --bg:#0b0b0f; --fg:#e8e8ef; --muted:#b9b9cc; --line:#232333;
    --tile:#141627; --tile2:#101223; --accent:#7aa7ff; --good:#2aa84a; --bad:#ff5d5d;
  }
  *{box-sizing:border-box}
  body{margin:0;background:var(--bg);color:var(--fg);font-family:-apple-system,BlinkMacSystemFont,"Noto Sans KR",Roboto,Arial,sans-serif}
  header{position:sticky;top:0;z-index:5;background:rgba(11,11,15,.9);backdrop-filter:blur(8px);border-bottom:1px solid var(--line)}
  .bar{display:flex;gap:10px;align-items:center;padding:14px 16px}
  .title{font-weight:900}
  .tabs{display:flex;gap:8px;margin-left:auto}
  .tab{padding:8px 12px;border-radius:10px;background:#1b1d2e;border:1px solid #2b2e48;cursor:pointer;white-space:nowrap}
  .tab.active{background:#27306a;border-color:#3a4aa2}

  main{padding:16px;display:grid;gap:16px;max-width:980px;margin:0 auto;padding-bottom:90px}
  .panel{background:var(--tile);border:1px solid var(--line);border-radius:14px;padding:14px}
  .panel h3{margin:0 0 10px;font-size:16px}
  .grid{display:grid;gap:12px}
  .grid.cols2{grid-template-columns:1fr 1fr}
  @media (max-width:820px){
    .grid.cols2{grid-template-columns:1fr}
  }
  .row{display:flex;gap:10px;align-items:center}
  .row label{width:120px;color:#cfd1e8;font-weight:700}
  .row .field{flex:1}
  input,select,textarea{
    width:100%;padding:10px 12px;border-radius:8px;border:1px solid #2c2f48;background:#0f1020;color:#fff;font-size:14px
  }
  textarea{min-height:72px;resize:vertical}
  .btnbar{display:flex;gap:8px;flex-wrap:wrap;margin-top:8px}
  .btn{padding:10px 14px;border-radius:10px;border:1px solid #2b2e48;background:#1b1d2e;color:#fff;cursor:pointer}
  .btn.primary{background:#2a5bff;border-color:#3d6aff}
  .btn.good{background:var(--good);border-color:#2a8d41}
  .btn.warn{background:#7a2a2a;border-color:#a23d3d}
  .btn.ghost{background:#121428}
  .list{display:flex;flex-direction:column;gap:10px}
  .item{background:var(--tile2);border:1px solid #23263f;border-radius:12px;padding:12px}
  .mini{font-size:12px;color:var(--muted)}
  .pill{display:inline-flex;align-items:center;gap:6px;padding:6px 10px;border-radius:999px;background:#1a1c2f;border:1px solid #2b2e54;font-size:12px}
  .line{height:1px;background:#23263f;margin:10px 0}
  .hint{color:#cdd0f6;font-size:13px}
  .kbd{background:#191b2d;border:1px solid #2b2e54;border-radius:6px;padding:2px 6px}

  /* í•˜ë‹¨ ë„¤ë¹„ê²Œì´ì…˜ */
  .btmnav{
    position:fixed;left:0;right:0;bottom:0;z-index:10;
    background:rgba(11,11,15,.9);backdrop-filter:blur(10px);
    border-top:1px solid var(--line);
  }
  .btmnav .wrap{max-width:980px;margin:0 auto;display:grid;grid-template-columns:repeat(6,1fr);gap:6px;padding:8px}
  .navitem{
    display:flex;flex-direction:column;align-items:center;justify-content:center;
    gap:4px;padding:8px 4px;border-radius:10px;border:1px solid #2b2e48;background:#14172a;cursor:pointer;font-size:12px;text-align:center;
  }
  .navitem.active{background:#27306a;border-color:#3a4aa2}
  .navitem .ico{font-size:18px;line-height:1}
</style>
</head>
<body>
<header>
  <div class="bar">
    <div class="title">ğŸï¸ RIMO â€” ê´€ë¦¬ì ë¯¸ë‹ˆí˜ì´ì§€</div>
    <div class="tabs">
      <!-- ìƒë‹¨ íƒ­ë„ ë™ì¼í•œ ëª…ì¹­ìœ¼ë¡œ ë§ì¶¤ -->
      <div class="tab active" data-tab="create">í¬ë£¨ ìƒì„±</div>
      <div class="tab" data-tab="joins">ë§¤ì¹­ ê´€ë¦¬</div>
      <div class="tab" data-tab="routes">ë£¨íŠ¸ ì œì•ˆ</div>
      <div class="tab" data-tab="feedback">í›„ê¸° ê´€ë¦¬</div>
      <div class="tab" data-tab="data">DBê´€ë¦¬</div>
    </div>
  </div>
</header>

<main>
  <!-- í¬ë£¨ ìƒì„± -->
  <section class="panel" data-page="create">
    <h3>í¬ë£¨ ìƒì„±</h3>
    <div class="grid cols2">
      <div class="panel" style="background:#101223">
        <div class="row"><label>ì œëª©</label><div class="field"><input id="c_title" placeholder="ì˜ˆ: &lt;ê°€ì„ë§ì´ ì¹´í˜ ë¼ì´ë”©&gt;"></div></div>
        <div class="row"><label>ì¶œë°œ ì¼ì‹œ</label><div class="field"><input id="c_time" type="text" placeholder="ì˜ˆ: 9ì›” 20ì¼ 23:00"></div></div>
        <div class="row"><label>ì¶œë°œì§€</label><div class="field"><input id="c_from" placeholder="ì˜ˆ: GS25 í•œê°•ë¥´ë„¤ìƒìŠ¤ ë°˜í¬2í˜¸"></div></div>
        <div class="row"><label>ë„ì°©ì§€</label><div class="field"><input id="c_to" placeholder="ì˜ˆ: RSG ì„±ìˆ˜"></div></div>
        <div class="row"><label>ì •ì›</label><div class="field"><input id="c_capacity" type="number" min="1" value="4"></div></div>
        <div class="row"><label>ìŠ¤íƒ€ì¼/í˜ì´ìŠ¤</label>
          <div class="field"><input id="c_styles" placeholder="ì˜ˆ: Urban, Easy"></div>
        </div>
        <div class="row"><label>ë°°ê¸°ëŸ‰</label><div class="field"><input id="c_cc" placeholder="ì˜ˆ: 400cc ì´ìƒ"></div></div>
        <div class="row"><label>ë©”ì‹œì§€</label><div class="field"><textarea id="c_msg" placeholder="ê°„ë‹¨í•œ ì•ˆë‚´/ë¶„ìœ„ê¸°"></textarea></div></div>
        <div class="row"><label>í…Œë§ˆ</label>
          <div class="field">
            <select id="c_theme">
              <option value="red">red</option>
              <option value="yellow">yellow</option>
              <option value="blue" selected>blue</option>
            </select>
          </div>
        </div>
      </div>

      <div class="panel" style="background:#101223">
        <div class="row"><label>ì¶œë°œ ìœ„ë„</label><div class="field"><input id="c_lat" type="number" step="0.000001" placeholder="37.xxxxxx"></div></div>
        <div class="row"><label>ì¶œë°œ ê²½ë„</label><div class="field"><input id="c_lng" type="number" step="0.000001" placeholder="126.xxxxxx"></div></div>
        <div class="row"><label>ë„ì°© ìœ„ë„</label><div class="field"><input id="c_toLat" type="number" step="0.000001" placeholder="37.xxxxxx"></div></div>
        <div class="row"><label>ë„ì°© ê²½ë„</label><div class="field"><input id="c_toLng" type="number" step="0.000001" placeholder="127.xxxxxx"></div></div>
        <div class="row"><label>í˜„ì¬/ì •ì›</label><div class="field"><input id="c_now" type="number" min="0" value="0"></div></div>
        <div class="btnbar">
          <button class="btn" id="btnDraft">ë“œë˜í”„íŠ¸ ì €ì¥</button>
          <button class="btn primary" id="btnPublish">ë©”ì¸ì— ë°œí–‰</button>
          <button class="btn ghost" id="btnNew">ìƒˆë¡œ ì‘ì„±</button>
        </div>
        <div class="hint">â€» ì¢Œí‘œëŠ” ì§€ë„ì— í•„ìš”í•©ë‹ˆë‹¤. ëª¨ë¥´ë©´ ì„ì‹œë¡œ ì¶œë°œ/ë„ì°©ë§Œ ì…ë ¥í•´ë‘ê³  ë‚˜ì¤‘ì— ë³´ì •í•´ë„ ë©ë‹ˆë‹¤.</div>
      </div>
    </div>

    <div class="panel">
      <h3>ë°œí–‰ëœ í¬ë£¨ ëª©ë¡</h3>
      <div id="pubList" class="list"></div>
    </div>
  </section>

  <!-- ë§¤ì¹­ ê´€ë¦¬ -->
  <section class="panel" data-page="joins" style="display:none">
    <h3>ë§¤ì¹­ ê´€ë¦¬ (í•¨ê»˜ íƒ€ê³  ì‹¶ì–´ìš”)</h3>
    <div class="hint">ë©”ì¸ í˜ì´ì§€ì—ì„œ â€œì´ëŒ€ë¡œ ì‹ ì²­í•˜ê¸°â€ ì‹œ <span class="kbd">localStorage</span>ì— ì €ì¥ë©ë‹ˆë‹¤.</div>
    <div class="row" style="margin-top:8px">
      <label>í•„í„°(í¬ë£¨ID)</label>
      <div class="field"><input id="f_joinCrewId" placeholder="ë¹ˆì¹¸=ì „ì²´"></div>
      <button class="btn" id="btnJoinFilter">í•„í„°</button>
    </div>
    <div id="joinList" class="list" style="margin-top:10px"></div>
  </section>

  <!-- ë£¨íŠ¸ ì œì•ˆ -->
  <section class="panel" data-page="routes" style="display:none">
    <h3>ë£¨íŠ¸ ì œì•ˆ</h3>
    <div class="grid cols2">
      <div class="panel" style="background:#101223">
        <div class="row"><label>ì œì•ˆì</label><div class="field"><input id="r_who" placeholder="ë‹‰ë„¤ì„"></div></div>
        <div class="row"><label>ì¶œë°œì§€</label><div class="field"><input id="r_from"></div></div>
        <div class="row"><label>ë„ì°©ì§€</label><div class="field"><input id="r_to"></div></div>
        <div class="row"><label>ë©”ëª¨</label><div class="field"><textarea id="r_note" placeholder="ì´ìœ /ìš”ì²­ í˜ì´ìŠ¤ ë“±"></textarea></div></div>
        <div class="btnbar"><button class="btn" id="btnRouteAdd">ì œì•ˆ ì €ì¥</button></div>
      </div>
      <div class="panel" style="background:#101223">
        <div class="row"><label>ìŠ¤íƒ€ì¼/í˜ì´ìŠ¤</label><div class="field"><input id="r_tags" placeholder="ì˜ˆ: Urban, Easy"></div></div>
        <div class="row"><label>ìš°ì„ ìˆœìœ„</label><div class="field"><select id="r_priority">
          <option>ë³´í†µ</option><option>ë†’ìŒ</option><option>ë‚®ìŒ</option></select></div></div>
        <div class="hint">ì €ì¥ëœ ì œì•ˆì„ ì•„ë˜ ëª©ë¡ì—ì„œ â€œë“œë˜í”„íŠ¸ë¡œ ì „ì†¡â€í•˜ë©´ ì¢Œì¸¡ ìƒì„±í¼ì— ìë™ ì±„ì›€ë©ë‹ˆë‹¤.</div>
      </div>
    </div>

    <div class="panel">
      <h3>ì €ì¥ëœ ì œì•ˆ ëª©ë¡</h3>
      <div id="routeList" class="list"></div>
    </div>
  </section>

  <!-- í›„ê¸° ê´€ë¦¬ -->
  <section class="panel" data-page="feedback" style="display:none">
    <h3>í›„ê¸° ê´€ë¦¬ (ë¼ì´ë”© ì¢…ë£Œ í›„ í”¼ë“œë°±)</h3>
    <div class="grid cols2">
      <div class="panel" style="background:#101223">
        <div class="row"><label>í¬ë£¨ID</label><div class="field"><input id="fb_crewId" placeholder="ì˜ˆ: crew1"></div></div>
        <div class="row"><label>í‰ê°€</label><div class="field"><select id="fb_vote"><option value="up">ì¶”ì²œ ğŸ‘</option><option value="down">ë¹„ì¶”ì²œ ğŸ‘</option></select></div></div>
        <div class="row"><label>ì‚¬ìœ </label><div class="field"><textarea id="fb_reason" placeholder="ê°„ë‹¨ ì½”ë©˜íŠ¸"></textarea></div></div>
        <div class="btnbar"><button class="btn good" id="btnFbSave">í”¼ë“œë°± ì €ì¥</button></div>
      </div>
      <div class="panel" style="background:#101223">
        <div class="row"><label>í•„í„°(í¬ë£¨ID)</label><div class="field"><input id="f_fbCrewId" placeholder="ë¹ˆì¹¸=ì „ì²´"></div></div>
        <div class="btnbar"><button class="btn" id="btnFbFilter">ì¡°íšŒ</button></div>
        <div id="fbList" class="list" style="margin-top:10px"></div>
      </div>
    </div>
  </section>

  <!-- DBê´€ë¦¬ -->
  <section class="panel" data-page="data" style="display:none">
    <h3>DBê´€ë¦¬ (ë°ì´í„° ë‚´ë³´ë‚´ê¸° / ê°€ì ¸ì˜¤ê¸°)</h3>
    <div class="btnbar">
      <button class="btn" id="btnExport">ì „ì²´ JSON ë‚´ë³´ë‚´ê¸°</button>
      <label class="btn">
        JSON ë¶ˆëŸ¬ì˜¤ê¸°
        <input id="importFile" type="file" accept="application/json" style="display:none">
      </label>
      <button class="btn warn" id="btnReset">ì „ì²´ ì´ˆê¸°í™”</button>
    </div>
    <div class="line"></div>
    <div class="hint">
      ì‚¬ìš© í‚¤: <span class="kbd">rimo_crews_v1</span>, <span class="kbd">rimo_applications_v1</span>,
      <span class="kbd">rimo_route_proposals_v1</span>, <span class="kbd">rimo_feedback_v1</span>
    </div>
  </section>
</main>

<!-- í•˜ë‹¨ 6ê°œ ë„¤ë¹„ -->
<nav class="btmnav">
  <div class="wrap">
    <div class="navitem active" data-go="create" title="í¬ë£¨ ìƒì„±">
      <div class="ico">ğŸ› ï¸</div><div>í¬ë£¨ ìƒì„±</div>
    </div>
    <div class="navitem" data-go="joins" title="ë§¤ì¹­ ê´€ë¦¬">
      <div class="ico">ğŸ¤</div><div>ë§¤ì¹­ ê´€ë¦¬</div>
    </div>
    <div class="navitem" data-go="routes" title="ë£¨íŠ¸ ì œì•ˆ">
      <div class="ico">ğŸ—ºï¸</div><div>ë£¨íŠ¸ ì œì•ˆ</div>
    </div>
    <div class="navitem" data-go="feedback" title="í›„ê¸° ê´€ë¦¬">
      <div class="ico">ğŸ“</div><div>í›„ê¸° ê´€ë¦¬</div>
    </div>
    <div class="navitem" data-go="data" title="DBê´€ë¦¬">
      <div class="ico">ğŸ—„ï¸</div><div>DBê´€ë¦¬</div>
    </div>
    <a class="navitem" id="goMain" href="#" target="_blank" rel="noopener" title="ë©”ì¸ ì´ë™">
      <div class="ico">ğŸ </div><div>ë©”ì¸ ì´ë™</div>
    </a>
  </div>
</nav>

<script>
/* ---------- config ---------- */
const MAIN_URL = "https://roowalix.github.io/RIMO-test/index.html"; // TODO: RIMO ë©”ì¸í˜ì´ì§€ URLë¡œ êµì²´í•˜ì„¸ìš”.

/* ---------- storage helpers ---------- */
const KEYS={
  crews:'rimo_crews_v1',
  apps:'rimo_applications_v1',
  routes:'rimo_route_proposals_v1',
  fb:'rimo_feedback_v1',
};
const load=(k,def)=>{try{return JSON.parse(localStorage.getItem(k)||JSON.stringify(def))}catch(e){return def}};
const save=(k,v)=>localStorage.setItem(k,JSON.stringify(v));
const uid=()=> 'crew'+Math.random().toString(36).slice(2,7);

/* ---------- page switch (tabs + bottom nav ê³µí†µ) ---------- */
function showPage(pageKey){
  document.querySelectorAll('[data-page]').forEach(p=>p.style.display = (p.dataset.page===pageKey)?'block':'none');
  // header tabs
  document.querySelectorAll('.tab').forEach(t=>{
    t.classList.toggle('active', t.dataset.tab===pageKey);
  });
  // bottom nav
  document.querySelectorAll('.btmnav .navitem').forEach(n=>{
    if(n.dataset.go){ n.classList.toggle('active', n.dataset.go===pageKey); }
  });
}
document.querySelectorAll('.tab').forEach(t=>{
  t.onclick=()=> showPage(t.dataset.tab);
});
document.querySelectorAll('.btmnav .navitem[data-go]').forEach(n=>{
  n.addEventListener('click', ()=> showPage(n.dataset.go));
});
document.getElementById('goMain').addEventListener('click', (e)=>{
  const a=e.currentTarget;
  if(!MAIN_URL || MAIN_URL==="#"){ e.preventDefault(); alert("MAIN_URLì„ ë©”ì¸í˜ì´ì§€ ì£¼ì†Œë¡œ êµì²´í•˜ì„¸ìš”."); return; }
  a.href = MAIN_URL;
});

/* ---------- publish list ---------- */
function renderPublished(){
  const list = document.getElementById('pubList');
  const crews = load(KEYS.crews,[]);
  list.innerHTML = crews.map(c=>`
    <div class="item">
      <div class="row" style="justify-content:space-between;align-items:flex-start">
        <div>
          <div><b>${c.title}</b> <span class="mini">(${c.id})</span></div>
          <div class="mini">â° ${c.time} Â· ğŸ“ ${c.from} â†’ ${c.to} Â· ğŸ‘¥ ${c.peopleNow||0}/${c.peopleMax}</div>
          <div class="mini">ğŸ¯ ${((c.styles||[]).join(' Â· '))||'-'} Â· ${c.cc||'-'}</div>
        </div>
        <div class="btnbar">
          <button class="btn" onclick='fillForm(${JSON.stringify(c)})'>ë¶ˆëŸ¬ì˜¤ê¸°</button>
          <button class="btn warn" onclick='removeCrew("${c.id}")'>ì‚­ì œ</button>
        </div>
      </div>
    </div>
  `).join('') || '<div class="mini">ë°œí–‰ëœ í¬ë£¨ê°€ ì—†ìŠµë‹ˆë‹¤.</div>';
}
function removeCrew(id){
  let crews = load(KEYS.crews,[]);
  crews = crews.filter(c=>c.id!==id);
  save(KEYS.crews,crews);
  renderPublished();
}

/* ---------- form helpers ---------- */
function getForm(){
  const styles = (document.getElementById('c_styles').value||'').split(',').map(s=>s.trim()).filter(Boolean);
  return {
    id: document.getElementById('c_id')?.value || uid(),
    theme: document.getElementById('c_theme').value,
    title: document.getElementById('c_title').value,
    time: document.getElementById('c_time').value,
    from: document.getElementById('c_from').value,
    to: document.getElementById('c_to').value,
    lat: parseFloat(document.getElementById('c_lat').value),
    lng: parseFloat(document.getElementById('c_lng').value),
    toLat: parseFloat(document.getElementById('c_toLat').value),
    toLng: parseFloat(document.getElementById('c_toLng').value),
    peopleNow: parseInt(document.getElementById('c_now').value||'0',10),
    peopleMax: parseInt(document.getElementById('c_capacity').value||'0',10),
    styles: styles,
    cc: document.getElementById('c_cc').value,
    msg: document.getElementById('c_msg').value
  };
}
function setForm(c){
  document.getElementById('c_title').value=c.title||'';
  document.getElementById('c_time').value=c.time||'';
  document.getElementById('c_from').value=c.from||'';
  document.getElementById('c_to').value=c.to||'';
  document.getElementById('c_capacity').value=c.peopleMax||4;
  document.getElementById('c_styles').value=(c.styles||[]).join(', ');
  document.getElementById('c_cc').value=c.cc||'';
  document.getElementById('c_msg').value=c.msg||'';
  document.getElementById('c_theme').value=c.theme||'blue';
  document.getElementById('c_lat').value = (c.lat??'');
  document.getElementById('c_lng').value = (c.lng??'');
  document.getElementById('c_toLat').value = (c.toLat??'');
  document.getElementById('c_toLng').value = (c.toLng??'');
  document.getElementById('c_now').value = c.peopleNow||0;

  if(!document.getElementById('c_id')){
    const hidden=document.createElement('input');
    hidden.type='hidden'; hidden.id='c_id'; hidden.value=c.id||uid();
    document.body.appendChild(hidden);
  }else{
    document.getElementById('c_id').value=c.id||uid();
  }
}
function clearForm(){
  setForm({id:uid(),theme:'blue',peopleMax:4,peopleNow:0});
  document.getElementById('c_styles').value='';
}

/* draft/publish */
document.getElementById('btnDraft').onclick=()=>{
  const draft=getForm();
  localStorage.setItem('rimo_draft_card',JSON.stringify(draft));
  alert('ë“œë˜í”„íŠ¸ ì €ì¥ ì™„ë£Œ');
};
document.getElementById('btnPublish').onclick=()=>{
  const card=getForm();
  if(!card.title || !card.time || !card.from || !card.to){
    alert('ì œëª©/ì‹œê°„/ì¶œë°œ/ë„ì°©ì€ í•„ìˆ˜ì…ë‹ˆë‹¤.'); return;
  }
  const crews=load(KEYS.crews,[]);
  const idx=crews.findIndex(x=>x.id===card.id);
  if(idx>=0) crews[idx]=card; else crews.push(card);
  save(KEYS.crews,crews);
  renderPublished();
  alert('ë©”ì¸ì— ë°œí–‰ë˜ì—ˆìŠµë‹ˆë‹¤!');
};
document.getElementById('btnNew').onclick=()=>{ clearForm(); };

/* route proposals */
document.getElementById('btnRouteAdd').onclick=()=>{
  const r={ id:'rt'+Math.random().toString(36).slice(2,7),
    who:val('r_who'), from:val('r_from'), to:val('r_to'),
    note:val('r_note'), tags:val('r_tags'), priority:val('r_priority'), ts:Date.now()
  };
  const routes=load(KEYS.routes,[]);
  routes.unshift(r); save(KEYS.routes,routes); renderRoutes(); clearRouteForm();
};
function clearRouteForm(){['r_who','r_from','r_to','r_note','r_tags'].forEach(id=>document.getElementById(id).value='');}
function val(id){return document.getElementById(id).value||'';}
function renderRoutes(){
  const list=document.getElementById('routeList');
  const routes=load(KEYS.routes,[]);
  list.innerHTML = routes.map(r=>`
    <div class="item">
      <div><b>${r.from} â†’ ${r.to}</b> <span class="mini">(${r.id}) Â· ${r.priority}</span></div>
      <div class="mini">ì œì•ˆ: ${r.who||'-'} | íƒœê·¸: ${r.tags||'-'}</div>
      <div class="mini">${r.note||''}</div>
      <div class="btnbar">
        <button class="btn" onclick='toDraftFromRoute("${r.id}")'>ë“œë˜í”„íŠ¸ë¡œ ì „ì†¡</button>
        <button class="btn warn" onclick='removeRoute("${r.id}")'>ì‚­ì œ</button>
      </div>
    </div>
  `).join('') || '<div class="mini">ë“±ë¡ëœ ì œì•ˆì´ ì—†ìŠµë‹ˆë‹¤.</div>';
}
function toDraftFromRoute(id){
  const routes=load(KEYS.routes,[]);
  const r=routes.find(x=>x.id===id); if(!r) return;
  // ì œì•ˆ â†’ ìƒì„± í¼ ìë™ ì±„ì›€
  setForm({
    id: uid(),
    theme:'blue',
    title:`<ë£¨íŠ¸ ì œì•ˆ> ${r.from}â†’${r.to}`,
    time:'',
    from:r.from, to:r.to,
    peopleMax:4, peopleNow:0,
    styles:(r.tags||'').split(',').map(s=>s.trim()).filter(Boolean),
    cc:'', msg:r.note||'',
  });
  alert('ìƒì„± í¼ì— ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤. ì„¸ë¶€ ì •ë³´ ì…ë ¥ í›„ ë°œí–‰í•˜ì„¸ìš”.');
}
function removeRoute(id){
  let routes=load(KEYS.routes,[]);
  routes=routes.filter(x=>x.id!==id); save(KEYS.routes,routes); renderRoutes();
}

/* joins (applications) */
function renderJoins(filterId=''){
  const list=document.getElementById('joinList');
  const apps=load(KEYS.apps,[]);
  const data = filterId ? apps.filter(a=>a.crewId===filterId) : apps;
  list.innerHTML = data.map(a=>`
    <div class="item">
      <div class="mini">${new Date(a.ts).toLocaleString()}</div>
      <div><b>${a.title}</b> <span class="mini">(${a.crewId})</span></div>
      <div class="mini">${a.from} â†’ ${a.to}</div>
      <div class="line"></div>
      <div style="white-space:pre-wrap">${a.text}</div>
    </div>
  `).join('') || '<div class="mini">ì•„ì§ ì‹ ì²­ì´ ì—†ìŠµë‹ˆë‹¤.</div>';
}
document.getElementById('btnJoinFilter').onclick=()=>{
  const v=document.getElementById('f_joinCrewId').value.trim();
  renderJoins(v);
}

/* feedback */
document.getElementById('btnFbSave').onclick=()=>{
  const fb=load(KEYS.fb,[]);
  const item={
    id:'fb'+Math.random().toString(36).slice(2,7),
    crewId: document.getElementById('fb_crewId').value.trim(),
    vote: document.getElementById('fb_vote').value,
    reason: document.getElementById('fb_reason').value.trim(),
    ts: Date.now()
  };
  if(!item.crewId){ alert('í¬ë£¨IDëŠ” í•„ìˆ˜'); return; }
  fb.unshift(item); save(KEYS.fb,fb); alert('ì €ì¥ë¨'); renderFb();
};
function renderFb(filterId=''){
  const list=document.getElementById('fbList');
  const fb=load(KEYS.fb,[]);
  const data=filterId ? fb.filter(x=>x.crewId===filterId) : fb;
  list.innerHTML = data.map(x=>`
    <div class="item">
      <div class="row" style="justify-content:space-between">
        <div><b>${x.crewId}</b> Â· <span class="mini">${new Date(x.ts).toLocaleString()}</span></div>
        <div class="pill" style="background:${x.vote==='up'?'#17331f':'#331717'};border-color:${x.vote==='up'?'#2f5a2f':'#5a2f2f'}">
          ${x.vote==='up'?'ğŸ‘ ì¶”ì²œ':'ğŸ‘ ë¹„ì¶”ì²œ'}
        </div>
      </div>
      <div class="mini" style="margin-top:6px;white-space:pre-wrap">${x.reason||''}</div>
    </div>
  `).join('') || '<div class="mini">í”¼ë“œë°±ì´ ì—†ìŠµë‹ˆë‹¤.</div>';
}
document.getElementById('btnFbFilter').onclick=()=>{
  const v=document.getElementById('f_fbCrewId').value.trim();
  renderFb(v);
}

/* data export/import/reset */
document.getElementById('btnExport').onclick=()=>{
  const blob=new Blob([JSON.stringify({
    crews:load(KEYS.crews,[]),
    apps:load(KEYS.apps,[]),
    routes:load(KEYS.routes,[]),
    feedback:load(KEYS.fb,[])
  },null,2)],{type:'application/json'});
  const a=document.createElement('a');
  a.href=URL.createObjectURL(blob);
  a.download='rimo-data.json';
  a.click();
};
document.getElementById('importFile').onchange=(e)=>{
  const file=e.target.files[0]; if(!file) return;
  const fr=new FileReader();
  fr.onload=()=>{
    try{
      const j=JSON.parse(fr.result);
      if(j.crews) save(KEYS.crews,j.crews);
      if(j.apps) save(KEYS.apps,j.apps);
      if(j.routes) save(KEYS.routes,j.routes);
      if(j.feedback) save(KEYS.fb,j.feedback);
      alert('ë¶ˆëŸ¬ì˜¤ê¸° ì™„ë£Œ');
      renderPublished(); renderRoutes(); renderJoins(); renderFb();
    }catch(err){ alert('JSON í˜•ì‹ ì˜¤ë¥˜'); }
  };
  fr.readAsText(file);
};
document.getElementById('btnReset').onclick=()=>{
  if(!confirm('ì •ë§ ì „ì²´ ì´ˆê¸°í™”í• ê¹Œìš”?')) return;
  [KEYS.crews,KEYS.apps,KEYS.routes,KEYS.fb,'rimo_draft_card'].forEach(k=>localStorage.removeItem(k));
  renderPublished(); renderRoutes(); renderJoins(); renderFb(); clearForm();
};

/* helpers exposed */
window.fillForm=(c)=>setForm(c);

/* init */
(function init(){
  // ë“œë˜í”„íŠ¸ ë³µêµ¬
  const d=load('rimo_draft_card',null); if(d) setForm(d); else clearForm();
  renderPublished(); renderRoutes(); renderJoins(); renderFb();
  showPage('create'); // ì²« ë¡œë”©ì€ 'í¬ë£¨ ìƒì„±'
})();
</script>
</body>
</html>
