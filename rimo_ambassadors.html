<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>RIMO — 엠버서더</title>
<style>
  :root{
    --bg:#0b0b0f; --fg:#e8e8ef; --muted:#b9b9cc; --line:#23243a;
    --tile:#101223; --tileBd:#23243a;
    --accent:#7aa7ff;

    --tab-bg:#182039; --tab-bd:#2d3559; --tab-ink:#e6e8ef;
    --tab-pri:#26346d; --tab-pri-bd:#3b53a8;
  }

  *{box-sizing:border-box}
  body{margin:0;background:var(--bg);color:var(--fg);
       font-family:-apple-system,BlinkMacSystemFont,"Noto Sans KR",Roboto,Helvetica,Arial,sans-serif}

  /* 헤더 (공통) */
  header{position:sticky;top:0;z-index:5;background:rgba(11,11,15,.9);
         backdrop-filter:blur(8px);border-bottom:1px solid #232333}
  .bar{display:flex;gap:10px;align-items:center;padding:14px 16px;height:56px}
  .logo{font-weight:900}
  .title{font-weight:800;opacity:.9}

  main{padding:16px;max-width:720px;margin:0 auto;display:flex;flex-direction:column;gap:12px;padding-bottom:100px}

  /* 카드 */
  .card{background:var(--tile);border:1px solid var(--tileBd);border-radius:16px;
        padding:10px 12px;display:flex;flex-direction:column;gap:7px;margin-bottom:10px}
  .head{display:flex;gap:14px;align-items:center}
  .avatar{width:72px;height:72px;border-radius:50%;background:#1a1c2f;font-size:36px;
          display:flex;align-items:center;justify-content:center;flex:0 0 auto}
  .idcol{min-width:0;flex:1}
  .nameRow{display:flex;align-items:center;gap:10px}
  .name{margin:0;font-size:16px;font-weight:800;line-height:1.2;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
  .intro{margin:4px 0 0;font-weight:600;font-size:13px;color:var(--fg)}
  .sub{margin:6px 0 0;color:var(--muted);font-size:13px}

  .matchBtn{margin-left:auto;display:inline-flex;align-items:center;gap:6px;
    padding:6px 8px;border-radius:999px;background:#1a1c2f;border:0;color:#e6e9ff;font-size:12px;font-weight:600;
    cursor:pointer;transition:box-shadow .15s ease, transform .15s ease}
  .matchBtn.active{background:rgba(122,167,255,.16);
    box-shadow:0 0 12px rgba(122,167,255,.5), 0 0 0 2px rgba(122,167,255,.25) inset;transform:translateY(-1px)}

  /* 핀 텍스트 — 한 행 최대 6개 */
  .traits{display:grid;grid-template-columns:repeat(6, max-content);gap:6px;justify-content:flex-start}
  .tag{display:inline-flex;align-items:center;justify-content:center;padding:6px 9px;border-radius:999px;
       background:#1a1c2f;border:0;font-size:10px;font-weight:500;color:#e6e9ff;white-space:nowrap}
  .tag.style.pill-urban{background:#1e2d55}
  .tag.style.pill-curve{background:#2a1f56}
  .tag.style.pill-tour{background:#1e3b3a}
  .tag.pace.pill-easy{background:#1f3a1f}
  .tag.pace.pill-balanced{background:#3a341e}
  .tag.pace.pill-dynamic{background:#3a1f1f}

  /* 하단 네비 (공통) */
  .tabbar{position:fixed;left:0;right:0;bottom:16px;z-index:2500;display:flex;gap:12px;justify-content:center}
  .tabbar .tab{background:var(--tab-bg);border:1px solid var(--tab-bd);color:var(--tab-ink);
               padding:12px 18px;border-radius:22px;font-weight:800;text-decoration:none;font-size:14px}
  .tabbar .tab.primary{background:var(--tab-pri);border-color:var(--tab-pri-bd)}

  /* 로딩/에러 */
  .hint{color:#cfd2ff;font-size:13px}
</style>
</head>
<body>
<header>
  <div class="bar">
    <div class="logo">🏍️ RIMO</div>
    <div class="title">엠버서더</div>
  </div>
</header>

<main>
  <section id="status" class="hint">목록을 불러오는 중…</section>
  <section id="list" aria-label="엠버서더 목록"></section>
</main>

<!-- 하단 네비 -->
<nav class="tabbar" aria-label="하단 네비게이션">
  <a href="index.html" class="tab">메인</a>
  <a href="rimo_profile.html" class="tab">프로필</a>
  <a href="rimo_ambassadors.html" class="tab primary">엠버서더</a>
</nav>

<script>
/* ====== 설정 ====== */
const REG_URL = "https://script.google.com/macros/s/AKfycbzQxqwEGD2JUIzDqB1dlOYmeld_jVR5ljkNRqRdPBc2iIL84L4x5qMIHN378oarjGeM/exec"; // 예: https://script.google.com/macros/s/AKfycb.../exec
const LS_PROFILE = 'rimo_profile_v1'; // 내 로컬 프로필(자기 카드 구분용)

/* 라벨 색 메타 */
const STYLE_META = {
  Urban:{cls:'pill-urban',  label:'Urban'},
  Curve:{cls:'pill-curve',  label:'Curve'},
  Tour: {cls:'pill-tour',   label:'Tour'},
};
const PACE_META = {
  Easy:    {cls:'pill-easy',     label:'Easy'},
  Balanced:{cls:'pill-balanced', label:'Balanced'},
  Dynamic: {cls:'pill-dynamic',  label:'Dynamic'},
};

function tagEl(cls, text){
  const div = document.createElement('div');
  div.className = 'tag ' + cls;
  div.textContent = text;
  return div;
}
function loadMyProfile(){
  try{ return JSON.parse(localStorage.getItem(LS_PROFILE)||'{}'); }
  catch(e){ return {}; }
}

async function fetchProfiles(){
  const res = await fetch(REG_URL, { method:'GET' });
  const j = await res.json();
  if (!j.ok) throw new Error(j.error || '시트 응답 오류');
  return j.data || [];
}

function createCard(p, isMe){
  const card = document.createElement('article');
  card.className = 'card';

  const head = document.createElement('div');
  head.className = 'head';

  const avatar = document.createElement('div');
  avatar.className = 'avatar';
  avatar.textContent = p.icon || '🏍️';

  const idcol = document.createElement('div');
  idcol.className = 'idcol';

  const nameRow = document.createElement('div');
  nameRow.className = 'nameRow';

  const name = document.createElement('h3');
  name.className = 'name';
  name.textContent = p.name || '라이더';

  const btn = document.createElement('button');
  btn.type = 'button';
  btn.className = 'matchBtn';

  if (isMe) {
    btn.textContent = '프로필 수정';
    btn.onclick = ()=> location.href = 'rimo_profile.html';
  } else {
    btn.innerHTML = '🤝 매칭희망';
    btn.onclick = ()=> alert('매칭 희망을 표시해 두었습니다! (테스트 버전)');
  }

  nameRow.appendChild(name);
  nameRow.appendChild(btn);

  idcol.appendChild(nameRow);

  // 자기소개(이름 아래, 따옴표/굵게)
  const introText = (p.intro || '').toString().slice(0,25);
  if (introText) {
    const intro = document.createElement('p');
    intro.className = 'intro';
    intro.textContent = `"${introText}"`;
    idcol.appendChild(intro);
  }

  // 지역 · 기종
  const sub = document.createElement('p');
  sub.className = 'sub';
  sub.textContent = `${p.region ? (p.region + ' · ') : ''}${p.bike || ''}`;
  idcol.appendChild(sub);

  head.appendChild(avatar);
  head.appendChild(idcol);

  // 스타일/페이스 — 단어형
  const traits = document.createElement('div');
  traits.className = 'traits';
  const styles = Array.isArray(p.styles) ? p.styles : [];
  const pace   = Array.isArray(p.pace)   ? p.pace   : [];

  const all = [
    ...styles.map(s=>({type:'style', key:s})),
    ...pace.map(s=>({type:'pace', key:s}))
  ];
  if (all.length === 0) traits.appendChild(tagEl('style','-'));
  else {
    all.forEach(item=>{
      if(item.type==='style' && STYLE_META[item.key]) {
        const m=STYLE_META[item.key];
        traits.appendChild(tagEl(`style ${m.cls}`, m.label));
      } else if (item.type==='pace' && PACE_META[item.key]) {
        const m=PACE_META[item.key];
        traits.appendChild(tagEl(`pace ${m.cls}`, m.label));
      } else {
        traits.appendChild(tagEl(item.type, item.key));
      }
    });
  }

  card.appendChild(head);
  card.appendChild(traits);
  return card;
}

(async function init(){
  const status = document.getElementById('status');
  const listEl = document.getElementById('list');

  try{
    if (!REG_URL || !/^https?:\/\//.test(REG_URL)) {
      status.textContent = '등록 서버 주소(REG_URL)가 설정되지 않았습니다.';
      return;
    }

    const data = await fetchProfiles();     // 시트 전체
    const me   = loadMyProfile();           // 내 로컬(이름/바이크/지역 기준으로 비교)

    listEl.innerHTML = '';
    data.forEach(p=>{
      const isMe = (me.name && me.bike && me.region) &&
                   (p.name===me.name && p.bike===me.bike && p.region===me.region);
      const card = createCard(p, isMe);
      listEl.appendChild(card);
    });

    status.textContent = data.length ? `총 ${data.length}명` : '등록된 엠버서더가 아직 없습니다.';
  }catch(err){
    console.error(err);
    status.textContent = '목록을 불러오는 중 오류가 발생했어요.';
  }
})();
</script>
</body>
</html>
