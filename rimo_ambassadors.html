<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>RIMO ‚Äî Ïó†Î≤ÑÏÑúÎçî</title>
<style>
  :root{
    --bg:#0b0b0f; --fg:#e8e8ef; --muted:#b9b9cc; --line:#23243a;
    --tile:#101223; --tileBd:#23243a; --accent:#7aa7ff;
    --tab-bg:#182039; --tab-bd:#2d3559; --tab-ink:#e6e8ef; --tab-pri:#26346d; --tab-pri-bd:#3b53a8;
  }
  *{box-sizing:border-box}
  body{margin:0;background:var(--bg);color:var(--fg);font-family:-apple-system,BlinkMacSystemFont,"Noto Sans KR",Roboto,Helvetica,Arial,sans-serif}
  header{position:sticky;top:0;z-index:5;background:rgba(11,11,15,.9);backdrop-filter:blur(8px);border-bottom:1px solid #232333}
  .bar{display:flex;gap:10px;align-items:center;padding:14px 16px;height:56px}
  .logo{font-weight:900}.title{font-weight:800;opacity:.9}
  main{padding:16px;max-width:720px;margin:0 auto;display:flex;flex-direction:column;gap:12px;padding-bottom:100px}
  .card{background:var(--tile);border:1px solid var(--tileBd);border-radius:16px;padding:10px 12px;display:flex;flex-direction:column;gap:7px;margin-bottom:10px}
  .head{display:flex;gap:14px;align-items:center}
  .avatar{width:72px;height:72px;border-radius:50%;background:#1a1c2f;font-size:36px;display:flex;align-items:center;justify-content:center;flex:0 0 auto}
  .idcol{min-width:0;flex:1}
  .nameRow{display:flex;align-items:center;gap:10px}
  .name{margin:0;font-size:16px;font-weight:800;line-height:1.2;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
  .intro{margin:4px 0 0;font-weight:600;font-size:13px;color:var(--fg)}
  .matchBtn{margin-left:auto;display:inline-flex;align-items:center;gap:6px;padding:6px 8px;border-radius:999px;background:#1a1c2f;border:0;color:#e6e9ff;font-size:12px;font-weight:600;cursor:pointer;transition:box-shadow .15s ease, transform .15s ease}
  .matchBtn.active{background:rgba(122,167,255,.16);box-shadow:0 0 12px rgba(122,167,255,.5), 0 0 0 2px rgba(122,167,255,.25) inset;transform:translateY(-1px)}
  .sub{margin:6px 0 0;color:var(--muted);font-size:13px}
  .traits{display:grid;grid-template-columns:repeat(6,max-content);gap:6px;justify-content:flex-start}
  .tag{display:inline-flex;align-items:center;justify-content:center;padding:6px 9px;border-radius:999px;background:#1a1c2f;border:0;font-size:10px;font-weight:500;color:#e6e9ff;white-space:nowrap}
  .tabbar{position:fixed;left:0;right:0;bottom:16px;z-index:2500;display:flex;gap:12px;justify-content:center}
  .tabbar .tab{background:var(--tab-bg);border:1px solid var(--tab-bd);color:var(--tab-ink);padding:12px 18px;border-radius:22px;font-weight:800;text-decoration:none;font-size:14px}
  .tabbar .tab.primary{background:var(--tab-pri);border-color:var(--tab-pri-bd)}
</style>
</head>
<body>
<header>
  <div class="bar"><div class="logo">üèçÔ∏è RIMO</div><div class="title">Ïó†Î≤ÑÏÑúÎçî</div></div>
</header>

<main>
  <section id="list" aria-label="Ïó†Î≤ÑÏÑúÎçî Î™©Î°ù"></section>
</main>

<nav class="tabbar" aria-label="ÌïòÎã® ÎÑ§ÎπÑÍ≤åÏù¥ÏÖò">
  <a href="index.html" class="tab">Î©îÏù∏</a>
  <a href="rimo_profile.html" class="tab">ÌîÑÎ°úÌïÑ</a>
  <a href="rimo_ambassadors.html" class="tab primary">Ïó†Î≤ÑÏÑúÎçî</a>
</nav>

<script>
/* ÏÑ§Ï†ï */
const REG_URL = 'https://script.google.com/macros/s/AKfycbxTjczRqIWrGoNSuwO7-VFzKAEUfg7ciDJvcJVm4mpcA4w4Y6nmGB8Hhm321AZseoYH/execc';  // ‚Üê Apps Script URL
const LSK_PROFILE='rimo_profile_v1';
const LSK_MATCH='rimo_match_wish_v1';

/* helpers */
const loadJson = (k, def) => { try { return JSON.parse(localStorage.getItem(k) || JSON.stringify(def)); } catch(e){ return def; } };
const saveJson = (k, v) => localStorage.setItem(k, JSON.stringify(v));
const loadProfile   = () => loadJson(LSK_PROFILE, {});
const loadMatchWish = () => new Set(loadJson(LSK_MATCH, []));
const saveMatchWish = (set) => saveJson(LSK_MATCH, Array.from(set));

/* Îç∞Î™® */
const demo = [
  { id:'d1', icon:'üõµ', name:'Mira',  region:'ÏÑúÏö∏ ÏÑ±ÎèôÍµ¨', bike:'Vespa Primavera', styles:['Urban'], pace:['Easy'],  intro:'ÏÑ±Ïàò¬∑Í∞ïÎÇ® Ïπ¥ÌéòÌà¨Ïñ¥ Ï¢ãÏïÑÏöî' },
  { id:'d2', icon:'üèçÔ∏è', name:'Owen',  region:'ÏÑúÏö∏ ÎßàÌè¨Íµ¨', bike:'Yamaha MT-07',   styles:['Curve','Tour'], pace:['Balanced'], intro:'Í∞ÄÏñëÎåÄÍµê~Î∂ÅÏïÖ ÌåîÍ∞ÅÏ†ï Ï¶êÍ≤®Ïöî' },
  { id:'d3', icon:'üê∂', name:'Nabi',  region:'ÏÑúÏö∏ ÏÜ°ÌååÍµ¨', bike:'Honda Grom',      styles:['Urban'], pace:['Dynamic'], intro:'Ïã¨Ïïº ÌïúÍ∞ï ÏàúÌôò Î∞§Î∞îÎ¶¨Îü¨!' },
];

/* ÏÑúÎ≤ÑÏóêÏÑú Ï†ÑÏ≤¥ Î™©Î°ù */
async function fetchPublic(){
  if(!REG_URL) return [];
  try{
    const res = await fetch(REG_URL + '?ts=' + Date.now()); // Ï∫êÏãú Ïö∞Ìöå
    const js  = await res.json();
    return (js.profiles||[]).map(p => ({
      id: p.deviceId || ('pub_'+Math.random().toString(36).slice(2,7)),
      icon: p.icon || 'üèçÔ∏è',
      name: p.name || 'ÎùºÏù¥Îçî',
      region: p.region || '',
      bike: p.bike || 'Î∞îÏù¥ÌÅ¨ ÎØ∏ÏûÖÎ†•',
      styles: Array.isArray(p.styles)? p.styles: [],
      pace: Array.isArray(p.pace)? p.pace: [],
      intro: (p.intro||'').slice(0,25)
    }));
  }catch(e){
    console.warn('fetchPublic failed', e);
    return [];
  }
}

/* Î™©Î°ù ÎßåÎì§Í∏∞ */
function buildLocalMine(){
  const me = loadProfile();
  return (me && me.name) ? [{
    id:'me', icon: me.icon || 'üèçÔ∏è',
    name: me.name + ' (ÎÇò)',
    region: me.region || '',
    bike: me.bike || 'Î∞îÏù¥ÌÅ¨ ÎØ∏ÏûÖÎ†•',
    styles: Array.isArray(me.styles)? me.styles: [],
    pace: Array.isArray(me.pace)? me.pace: [],
    intro: (me.intro || '').slice(0,25)
  }] : [];
}

const listEl = document.getElementById('list');
const STYLE_META = { Urban:{label:'Urban'}, Curve:{label:'Curve'}, Tour:{label:'Tour'} };
const PACE_META  = { Easy:{label:'Easy'}, Balanced:{label:'Balanced'}, Dynamic:{label:'Dynamic'} };

function tagEl(text){
  const div = document.createElement('div');
  div.className = 'tag';
  div.textContent = text;
  return div;
}

function renderCards(arr){
  const wishes = loadMatchWish();
  listEl.innerHTML = '';
  arr.forEach(a=>{
    const card = document.createElement('article'); card.className='card';
    const head = document.createElement('div'); head.className='head';
    const avatar = document.createElement('div'); avatar.className='avatar'; avatar.textContent = a.icon || 'üèçÔ∏è';
    const idcol = document.createElement('div'); idcol.className='idcol';
    const nameRow = document.createElement('div'); nameRow.className='nameRow';
    const name = document.createElement('h3'); name.className='name'; name.textContent=a.name||'ÎùºÏù¥Îçî';

    if(a.id==='me'){
      const editBtn = document.createElement('button'); editBtn.type='button'; editBtn.className='matchBtn'; editBtn.textContent='ÌîÑÎ°úÌïÑ ÏàòÏ†ï';
      editBtn.addEventListener('click',()=>location.href='rimo_profile.html');
      nameRow.appendChild(name); nameRow.appendChild(editBtn);
    } else {
      const matchBtn = document.createElement('button'); matchBtn.type='button'; matchBtn.className='matchBtn';
      const wished = wishes.has(a.id); if(wished) matchBtn.classList.add('active');
      matchBtn.innerHTML = `${wished?'‚úÖ':'ü§ù'} Îß§Ïπ≠Ìù¨Îßù`;
      matchBtn.addEventListener('click', ()=>{
        if(wishes.has(a.id)) wishes.delete(a.id); else wishes.add(a.id);
        saveMatchWish(wishes);
        matchBtn.classList.toggle('active');
        matchBtn.innerHTML = `${wishes.has(a.id)?'‚úÖ':'ü§ù'} Îß§Ïπ≠Ìù¨Îßù`;
      });
      nameRow.appendChild(name); nameRow.appendChild(matchBtn);
    }

    idcol.appendChild(nameRow);

    if(a.intro){
      const intro = document.createElement('p'); intro.className='sub intro'; intro.textContent=`"${a.intro}"`;
      idcol.appendChild(intro);
    }

    const sub = document.createElement('p'); sub.className='sub';
    sub.textContent = `${a.region? a.region+' ¬∑ ' : ''}${a.bike||''}`;
    idcol.appendChild(sub);

    head.appendChild(avatar); head.appendChild(idcol);
    card.appendChild(head);

    const traits = document.createElement('div'); traits.className='traits';
    const styles = a.styles||[], pace=a.pace||[];
    const all = [...styles.map(s=>STYLE_META[s]?.label||s), ...pace.map(p=>PACE_META[p]?.label||p)];
    if(all.length===0) traits.appendChild(tagEl('-')); else all.forEach(t=>traits.appendChild(tagEl(t)));
    card.appendChild(traits);

    listEl.appendChild(card);
  });
}

/* Ï¥àÍ∏∞ Î°úÎìú: ÏÑúÎ≤Ñ Î™©Î°ù + ÎÇ¥ Î°úÏª¨ + Îç∞Î™® */
(async function init(){
  const [pub] = await Promise.all([fetchPublic()]);
  const mine  = buildLocalMine();
  // Ï§ëÎ≥µ Ï†úÍ±∞(Ïù¥Î¶Ñ+ÏßÄÏó≠ Í∏∞Ï§Ä Í∞ÑÎã® Ï≤òÎ¶¨)
  const key = o => (o.name||'')+'|'+(o.region||'')+'|'+(o.id==='me'?'me':'');
  const merged = [];
  const seen = new Set();
  [...mine, ...pub, ...demo].forEach(x=>{
    const k = key(x); if(seen.has(k)) return; seen.add(k); merged.push(x);
  });
  renderCards(merged);
})();
</script>
</body>
</html>
