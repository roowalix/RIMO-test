<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>RIMO â€” ë¼ì´ë” ì¹´ë“œ</title>
<style>
  :root{
    --bg:#0b0b0f; --ink:#f1f3ff; --muted:#b6b8cc; --line:#23243a;
    --tile:#141627; --accent:#7aa7ff;
    --label-width:40px;
    --tab-bg:#182039; --tab-bd:#2d3559; --tab-ink:#e6e8ef;
    --tab-pri:#26346d; --tab-pri-bd:#3b53a8;
  }
  *{box-sizing:border-box}
  body{margin:0;background:var(--bg);color:var(--ink);
    font-family:-apple-system,BlinkMacSystemFont,"Noto Sans KR",Roboto,Helvetica,Arial,sans-serif;}

  header{position:sticky;top:0;z-index:5;background:rgba(11,11,15,.9);
         backdrop-filter:blur(8px);border-bottom:1px solid #232333}
  .bar{display:flex;gap:10px;align-items:center;padding:14px 16px;height:56px}
  .logo{font-weight:900}
  .title{font-weight:800;opacity:.9}

  main{padding:16px;max-width:520px;margin:0 auto;display:flex;flex-direction:column;gap:12px;padding-bottom:100px;}
  .panel{background:var(--tile);padding:12px;border-radius:14px;border:1px solid var(--line);display:flex;flex-direction:column;gap:10px}
  .form-row{display:flex;align-items:center;gap:0;margin-bottom:0}
  .form-row.top{align-items:flex-start}
  .form-row label{width:var(--label-width);font-size:14px;font-weight:700;white-space:nowrap}
  .field{flex:1}
  input[type="text"],select,textarea{width:100%;padding:8px 12px;border-radius:8px;border:1px solid #2c2f48;background:#0f1020;color:#fff;font-size:14px}
  textarea{resize:none;height:40px}
  .toggles{display:flex;gap:4px;flex-wrap:wrap;margin:4px 0}
  .toggle{display:inline-flex;align-items:center;gap:8px;padding:8px 12px;border-radius:999px;border:1px solid #2b2e54;background:#1a1c2f;color:#e6e9ff;font-size:13px;cursor:pointer;user-select:none;white-space:nowrap;transition:transform .15s ease, box-shadow .15s ease, border-color .15s ease, background-color .15s ease;}
  .toggle.active{border-color:var(--accent);border-width:2px;background:rgba(122,167,255,.16);box-shadow:0 0 10px rgba(122,167,255,.45);transform:translateY(-1px) scale(1.03);font-weight:800;}
  .profile-icons{display:flex;flex-direction:column;align-items:center;gap:10px;margin:0}
  .icons{display:grid;grid-template-columns:repeat(5,48px);grid-auto-rows:48px;gap:10px;justify-content:center}
  .icon-btn{width:50px;height:50px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:28px;cursor:pointer;background:#1a1c2f;border:1px solid #2c2f48;transition:.15s ease;color:#fff}
  .icon-btn.active{border-color:var(--accent);box-shadow:0 0 10px rgba(122,167,255,.4);transform:scale(1.05)}
  .intro-box{width:calc(48px*5 + 10px*4);margin:8px 0 0}
  #intro{width:100%;text-align:center;font-size:13px}
  .btnrow{display:flex;gap:8px;flex-wrap:wrap}
  .save-btn{flex:1;min-width:140px;padding:14px;margin-top:6px;font-size:15px;font-weight:700;background:#2a5bff;border:none;color:#fff;border-radius:10px;cursor:pointer}
  .tabbar{position:fixed;left:0;right:0;bottom:16px;z-index:2500;display:flex;gap:12px;justify-content:center}
  .tabbar .tab{background:var(--tab-bg);border:1px solid var(--tab-bd);color:var(--tab-ink);padding:12px 18px;border-radius:22px;font-weight:800;text-decoration:none;font-size:14px}
  .tabbar .tab.primary{background:var(--tab-pri);border-color:var(--tab-pri-bd)}
  .modal{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,.5);z-index:3000;padding:16px}
  .modal.show{display:flex}
  .modal-content{width:100%;max-width:520px;background:#101223;border:1px solid var(--line);border-radius:16px;box-shadow:0 8px 24px rgba(0,0,0,.4);padding:18px 16px;display:flex;flex-direction:column;gap:12px}
  .card-head{display:flex;gap:14px;align-items:center}
  .avatar{width:72px;height:72px;border-radius:50%;background:#1a1c2f;font-size:36px;display:flex;align-items:center;justify-content:center;flex:0 0 auto}
  .idcol{min-width:0}
  .name{margin:0 0 4px;font-size:18px;font-weight:800}
  .sub{margin:0;color:var(--muted);font-size:13px}
  .grid-3{display:grid;grid-template-columns:repeat(3,1fr);gap:8px}
  .tag{display:inline-flex;align-items:center;justify-content:center;gap:6px;padding:8px 10px;border-radius:999px;background:#1a1c2f;border:1px solid #2b2e54;font-size:12px;white-space:nowrap}
</style>
</head>
<body>
<header>
  <div class="bar">
    <div class="logo">ğŸï¸ RIMO</div>
    <div class="title">ì— ë²„ì„œë” ë¼ì´ë” ì¹´ë“œ</div>
  </div>
</header>

<main>
  <section class="panel">
    <div class="form-row"><label>ë¼ì´ë”</label><div class="field"><input id="handle" type="text" placeholder="ì˜ˆ: RIMO rider"></div></div>
    <div class="form-row"><label>ê¸°ì¢…</label><div class="field"><input id="bike" type="text" placeholder="ì˜ˆ: Honda MSX125"></div></div>
    <div class="form-row">
      <label>ì§€ì—­</label>
      <div class="field">
        <select id="region">
          <option value="">ì§€ì—­ ì„ íƒ</option>
          <option>ì„œìš¸ ê°•ë‚¨êµ¬</option><option>ì„œìš¸ ê°•ë™êµ¬</option><option>ì„œìš¸ ê°•ë¶êµ¬</option><option>ì„œìš¸ ê°•ì„œêµ¬</option>
          <option>ì„œìš¸ ê´€ì•…êµ¬</option><option>ì„œìš¸ ê´‘ì§„êµ¬</option><option>ì„œìš¸ êµ¬ë¡œêµ¬</option><option>ì„œìš¸ ê¸ˆì²œêµ¬</option>
          <option>ì„œìš¸ ë…¸ì›êµ¬</option><option>ì„œìš¸ ë„ë´‰êµ¬</option><option>ì„œìš¸ ë™ëŒ€ë¬¸êµ¬</option><option>ì„œìš¸ ë™ì‘êµ¬</option>
          <option>ì„œìš¸ ë§ˆí¬êµ¬</option><option>ì„œìš¸ ì„œëŒ€ë¬¸êµ¬</option><option>ì„œìš¸ ì„œì´ˆêµ¬</option><option>ì„œìš¸ ì„±ë™êµ¬</option>
          <option>ì„œìš¸ ì„±ë¶êµ¬</option><option>ì„œìš¸ ì†¡íŒŒêµ¬</option><option>ì„œìš¸ ì–‘ì²œêµ¬</option><option>ì„œìš¸ ì˜ë“±í¬êµ¬</option>
          <option>ì„œìš¸ ìš©ì‚°êµ¬</option><option>ì„œìš¸ ì€í‰êµ¬</option><option>ì„œìš¸ ì¢…ë¡œêµ¬</option><option>ì„œìš¸ ì¤‘êµ¬</option>
          <option>ì„œìš¸ ì¤‘ë‘êµ¬</option>
        </select>
      </div>
    </div>
    <div class="form-row"><label>ì‹œê°„ëŒ€</label><div class="field">
      <select id="time">
        <option value="05:00â€“10:00 (ì•„ì¹¨)">05:00â€“10:00 (ì•„ì¹¨)</option>
        <option value="14:00â€“17:00 (ì˜¤í›„)">14:00â€“17:00 (ì˜¤í›„)</option>
        <option value="18:00â€“22:00 (ì €ë…)">18:00â€“22:00 (ì €ë…)</option>
        <option value="23:00â€“03:00 (ì‹¬ì•¼)">23:00â€“03:00 (ì‹¬ì•¼)</option>
      </select>
    </div></div>
    <div class="form-row"><label>íƒ ë¤</label><div class="field">
      <select id="tandem"><option value="í—ˆìš©">í—ˆìš©</option><option value="ë¶ˆê°€">ë¶ˆê°€</option></select>
    </div></div>

    <div class="form-row"><label>ìŠ¤íƒ€ì¼</label>
      <div class="toggles" data-group="style">
        <span class="toggle" data-value="Urban">Urban</span>
        <span class="toggle" data-value="Curve">Curve</span>
        <span class="toggle" data-value="Tour">Tour</span>
      </div>
    </div>
    <div class="form-row"><label>í˜ì´ìŠ¤</label>
      <div class="toggles" data-group="speed">
        <span class="toggle" data-value="Easy">Easy</span>
        <span class="toggle" data-value="Balanced">Balanced</span>
        <span class="toggle" data-value="Dynamic">Dynamic</span>
      </div>
    </div>

    <div class="profile-icons">
      <div class="icons" id="iconSelect">
        <div class="icon-btn" data-icon="ğŸï¸">ğŸï¸</div>
        <div class="icon-btn" data-icon="ğŸ›µ">ğŸ›µ</div>
        <div class="icon-btn" data-icon="ğŸ”¥">ğŸ”¥</div>
        <div class="icon-btn" data-icon="ğŸŒŠ">ğŸŒŠ</div>
        <div class="icon-btn" data-icon="â˜•">â˜•</div>
        <div class="icon-btn" data-icon="â­">â­</div>
        <div class="icon-btn" data-icon="ğŸ">ğŸ</div>
        <div class="icon-btn" data-icon="ğŸ¶">ğŸ¶</div>
        <div class="icon-btn" data-icon="âš¡">âš¡</div>
        <div class="icon-btn" data-icon="ğŸ±">ğŸ±</div>
      </div>
      <div class="intro-box">
        <textarea id="intro" maxlength="25" placeholder="ê°„ë‹¨í•œ ìê¸°ì†Œê°œ (25ì ì´ë‚´)"></textarea>
      </div>
    </div>

    <div class="btnrow">
      <button class="save-btn" id="saveBtn">í”„ë¡œí•„ ì €ì¥ & ë“±ë¡</button>
    </div>
  </section>
</main>

<nav class="tabbar" aria-label="í•˜ë‹¨ ë„¤ë¹„ê²Œì´ì…˜">
  <a href="index.html" class="tab">ë©”ì¸</a>
  <a href="rimo_profile.html" class="tab primary">í”„ë¡œí•„</a>
  <a href="rimo_ambassadors.html" class="tab">ì— ë²„ì„œë”</a>
</nav>

<!-- ë¯¸ë¦¬ë³´ê¸°(ê°„ë‹¨) -->
<div class="modal" id="previewModal">
  <div class="modal-content">
    <div class="card-head">
      <div class="avatar" id="avatarPreview">ğŸï¸</div>
      <div class="idcol">
        <h3 class="name" id="namePreview">ë¼ì´ë” ì´ë¦„</h3>
        <p class="sub" id="bikePreview">ì„œìš¸ ì§€ì—­ Â· ë°”ì´í¬ ë¯¸ì…ë ¥</p>
      </div>
    </div>
    <div class="grid-3" id="styleGrid"></div>
    <div class="grid-3" id="paceGrid"></div>
    <div class="modal-actions">
      <button class="ok" id="confirmBtn">í™•ì¸</button>
      <button class="edit" id="editBtn">ìˆ˜ì •</button>
    </div>
  </div>
</div>

<script>
/* === í™˜ê²½ ì„¤ì • === */
const REG_URL = 'https://script.google.com/macros/s/AKfycbz97jUHRRsaXJpmZSq0WWQpWXepzZksnH4Txa1oC4D-fBD3JlogrgwGzp3TjNG1xbFu/exec';   // â† Apps Script ì›¹ ì•± URL
const LS_KEY  = 'rimo_profile_v1';

/* ë””ë°”ì´ìŠ¤ID (ì—…ì„œíŠ¸ í‚¤) */
function getDeviceId(){
  let id = localStorage.getItem('rimo_device_id');
  if(!id){ id = 'dev_' + Math.random().toString(36).slice(2,10); localStorage.setItem('rimo_device_id', id); }
  return id;
}

/* ì•„ì´ì½˜ ì„ íƒ */
let selectedIcon="ğŸï¸";
const iconWrap=document.getElementById("iconSelect");
function updateIconActive(){
  iconWrap.querySelectorAll(".icon-btn").forEach(b => b.classList.toggle("active", b.dataset.icon === selectedIcon));
}
iconWrap.addEventListener("click", e=>{
  const btn=e.target.closest(".icon-btn"); if(!btn) return;
  selectedIcon=btn.dataset.icon; updateIconActive(); saveProfile();
});

/* í† ê¸€(í•„) */
document.querySelectorAll('.toggles').forEach(g=>{
  g.addEventListener('click', e=>{
    const t=e.target.closest('.toggle'); if(!t) return;
    t.classList.toggle('active'); saveProfile();
  });
});

/* ìˆ˜ì§‘/ì €ì¥ */
function collectProfile(){
  const styles=[...document.querySelectorAll('.toggles[data-group="style"] .toggle.active')].map(el=>el.dataset.value);
  const pace=[...document.querySelectorAll('.toggles[data-group="speed"] .toggle.active')].map(el=>el.dataset.value);
  return {
    deviceId:getDeviceId(),
    name:document.getElementById('handle').value||'ë¼ì´ë” ì´ë¦„',
    bike:document.getElementById('bike').value||'ë°”ì´í¬ ë¯¸ì…ë ¥',
    region:document.getElementById('region').value||'',
    styles, pace,
    time:document.getElementById('time').value,
    tandem:document.getElementById('tandem').value,
    icon:selectedIcon,
    intro:(document.getElementById('intro').value||'').slice(0,25),
    updatedAt: Date.now()
  };
}
function saveProfile(){
  const p=collectProfile();
  localStorage.setItem(LS_KEY, JSON.stringify(p));
  return p;
}
function loadProfile(){
  try{ return JSON.parse(localStorage.getItem(LS_KEY)||'{}'); }catch(e){ return {}; }
}

/* ì„œë²„ ë“±ë¡(ì—…ì„œíŠ¸) â€” ê°„ë‹¨ í¼ì „ì†¡ìœ¼ë¡œ CORS í”„ë¦¬í”Œë¼ì´íŠ¸ íšŒí”¼ */
function registerProfile(p){
  if(!REG_URL) return;
  const body = 'payload=' + encodeURIComponent(JSON.stringify(p));
  fetch(REG_URL, {
    method:'POST',
    headers:{'Content-Type':'application/x-www-form-urlencoded;charset=UTF-8'},
    body
  }).catch(console.warn);
}

/* ë¯¸ë¦¬ë³´ê¸° */
function showPreview(p){
  document.getElementById('avatarPreview').textContent = p.icon || 'ğŸï¸';
  document.getElementById('namePreview').textContent   = p.name || 'ë¼ì´ë” ì´ë¦„';
  document.getElementById('bikePreview').textContent   = `${p.region? p.region+' Â· ' : ''}${p.bike||'ë°”ì´í¬ ë¯¸ì…ë ¥'}`;

  const toTags=(arr)=> (arr&&arr.length?arr:['-']).map(s=>`<div class="tag">${s}</div>`).join('');
  document.getElementById('styleGrid').innerHTML = toTags(p.styles);
  document.getElementById('paceGrid').innerHTML  = toTags(p.pace);

  document.getElementById('previewModal').classList.add('show');
}

/* ì´ë²¤íŠ¸ */
['handle','bike','region','time','tandem','intro'].forEach(id=>{
  const el=document.getElementById(id);
  el.addEventListener('input', saveProfile);
  el.addEventListener('change', saveProfile);
});

document.getElementById('saveBtn').addEventListener('click',()=>{
  const p=saveProfile();
  registerProfile(p);       // â† ì €ì¥ê³¼ ë™ì‹œì— ì— ë²„ì„œë” â€œë“±ë¡/ì—…ë°ì´íŠ¸â€
  showPreview(p);
});
document.getElementById('confirmBtn').addEventListener('click',()=>{
  document.getElementById('previewModal').classList.remove('show');
  location.href='rimo_ambassadors.html'; // ë“±ë¡ í™•ì¸í•˜ëŸ¬ ì´ë™
});
document.getElementById('editBtn').addEventListener('click',()=>{
  document.getElementById('previewModal').classList.remove('show');
});

/* ì´ˆê¸°í™” */
(function init(){
  const p=loadProfile();
  if(p.name)   document.getElementById('handle').value=p.name;
  if(p.bike)   document.getElementById('bike').value=p.bike;
  if(p.region) document.getElementById('region').value=p.region;
  if(p.time)   document.getElementById('time').value=p.time;
  if(p.tandem) document.getElementById('tandem').value=p.tandem;
  if(p.intro)  document.getElementById('intro').value=p.intro;
  if(Array.isArray(p.styles)){
    p.styles.forEach(v=>{ const el=[...document.querySelectorAll('.toggles[data-group="style"] .toggle')].find(x=>x.dataset.value===v); if(el) el.classList.add('active');});
  }
  if(Array.isArray(p.pace)){
    p.pace.forEach(v=>{ const el=[...document.querySelectorAll('.toggles[data-group="speed"] .toggle')].find(x=>x.dataset.value===v); if(el) el.classList.add('active');});
  }
  if(p.icon){ selectedIcon=p.icon; }
  updateIconActive();
})();
</script>
</body>
</html>
